<!doctype html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <meta name="author" content="Maasq" />
      <meta name="description" content="A tool for creating and managing NPCs." />
      <meta name="version" content="0.18.07" />
      <meta name="date" content="2025-11-15" />

      <title>NPC Engineer</title>

      <script src="https://cdn.tailwindcss.com"></script>
      <script src="../libs/dexie.js"></script>
      <link rel="stylesheet" type="text/css" href="../libs/trix.css">
      <script type="text/javascript" src="../libs/trix.umd.min.js"></script>
      <script src="../libs/jszip.min.js"></script>
      
      <link rel="preconnect" href="https://fonts.googleapis.com" />
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
      <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;700&display=swap" rel="stylesheet" />
      <link href="https://fonts.googleapis.com/css2?family=Cormorant+SC:wght@400;500;700&display=swap" rel="stylesheet" />
      <link href="https://fonts.googleapis.com/css2?family=Questrial&display=swap" rel="stylesheet" />
      <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet" />
      <link href="https://fonts.googleapis.com/css2?family=Macondo+Swash+Caps&display=swap" rel="stylesheet" />
      <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400&display=swap" rel="stylesheet">

      <link rel="stylesheet" href="style.css">
   </head>
   
   <body class="bg-[#E2E8F0]">
      <div class="max-w-screen-2xl mx-auto px-6 pb-6">

         <header class="sticky top-0 z-50 bg-[#E2E8F0] pt-1 pb-12">
             <div class="relative h-24">

                 <div class="absolute top-2 left-2 z-40">
                     <button id="hamburger-btn" title="Open main menu" class="w-10 h-10 flex items-center justify-center rounded-full bg-transparent hover:bg-violet-200 transition-colors">
                         <svg class="h-6 w-6 text-black"><use href="#icon-hamburger"></use></svg>
                     </button>
                     <div id="main-menu" class="absolute left-0 mt-2 w-56 bg-white rounded-md shadow-lg z-50 hidden">
                         <div class="relative group/bestiaries">
                             <div class="flex justify-between items-center w-full px-4 py-1 text-sm text-gray-700 hover:bg-gray-100 cursor-default">
                                 <span>Bestiaries</span>
                                 <svg class="w-4 h-4"><use href="#icon-chevron"></use></svg>
                             </div>
                             <div class="absolute left-full top-0 w-56 bg-white rounded-md shadow-lg z-50 hidden group-hover/bestiaries:block">
                                 <a href="#" id="menu-new-bestiary" class="menu-item block px-4 py-1 text-sm text-gray-700 hover:bg-gray-100">New Bestiary</a>
                                 <a href="#" id="menu-load-bestiary" class="menu-item block px-4 py-1 text-sm text-gray-700 hover:bg-gray-100">Select Bestiary</a>
                                 <a href="#" id="menu-import-bestiary" class="menu-item block px-4 py-1 text-sm text-gray-700 hover:bg-gray-100">Import Bestiary</a>
                                 <a href="#" id="menu-export-bestiary" class="menu-item block px-4 py-1 text-sm text-gray-700 hover:bg-gray-100">Export Bestiary</a>
                             </div>
                         </div>								
                         <hr class="my-1"/>
                         <div class="relative group/npcs">
                             <div class="flex justify-between items-center w-full px-4 py-1 text-sm text-gray-700 hover:bg-gray-100 cursor-default">
                                 <span>NPCs</span>
                                 <svg class="w-4 h-4"><use href="#icon-chevron"></use></svg>
                             </div>
                             <div class="absolute left-full top-0 w-56 bg-white rounded-md shadow-lg z-50 hidden group-hover/npcs:block">
                                 <a href="#" id="menu-new-npc" class="menu-item block px-4 py-1 text-sm text-gray-700 hover:bg-gray-100">New NPC</a>
                                 <a href="#" id="menu-duplicate-npc" class="menu-item block px-4 py-1 text-sm text-gray-700 hover:bg-gray-100">Duplicate NPC</a>
                                 <a href="#" id="menu-import-npc" class="menu-item block px-4 py-1 text-sm text-gray-700 hover:bg-gray-100">Import NPC</a>
                                 <a href="#" id="menu-export-npc" class="menu-item block px-4 py-1 text-sm text-gray-700 hover:bg-gray-100">Export NPC</a>
                                 <a href="#" id="menu-delete-npc" class="menu-item block px-4 py-1 text-sm text-red-600 hover:bg-red-50">Delete NPC</a>
                             </div>
                         </div>
                         <hr class="my-1"/>
                         <a href="#" id="menu-import-text" class="menu-item block px-4 py-1 text-sm text-gray-700 hover:bg-gray-100">Import NPC from Text</a>
                         <a href="#" id="menu-export-fg" class="menu-item block px-4 py-1 text-sm text-gray-700 hover:bg-gray-100">Export Bestiary to FG</a>
								<hr class="my-1"/>
								<a href="#" id="menu-export-db" class="menu-item block px-4 py-1 text-sm text-gray-700 hover:bg-gray-100">Export Full Database</a>
								<a href="#" id="menu-import-db" class="menu-item block px-4 py-1 text-sm text-gray-700 hover:bg-gray-100">Import Full Database</a>
								<hr class="my-1"/>
                         <a href="#" id="menu-settings" class="menu-item block px-4 py-1 text-sm text-gray-700 hover:bg-gray-100">Settings</a>
                     </div>
                 </div>

                 <div class="absolute w-32 h-32 bg-black rounded-full custom-shadow z-10" style="top: 16px; left: 28px"></div>
                 <div id="logo-container" class="absolute w-32 h-32 rounded-full z-30 overflow-hidden cursor-pointer" style="top: 16px; left: 28px;">
                     <img src="graphics/npc engineer.webp" alt="NPC Engineer Logo" class="block w-full h-full" />
                 </div>


                 <div id="bestiary-buttons" class="absolute right-3 top-[15px] z-30 flex items-center space-x-4">
                     <span id="bestiary-status" class="text-sm font-medium text-gray-600 mr-2">No Bestiary Loaded</span>
                     <button id="newBestiaryBtn" title="Create a new Bestiary" class="transition duration-150 p-1.5 text-black rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-black"> <svg class="h-6 w-6" fill="currentColor"><use href="#icon-new-bestiary"></use></svg>
                     </button>
                     <button id="loadBestiaryBtn" title="Select one of your Bestiaries to edit" class="transition duration-150 p-1.5 text-black rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-black"> <svg class="h-6 w-6" fill="currentColor"><use href="#icon-load-bestiary"></use></svg>
                     </button>
                     <button id="importBestiaryBtn" title="Import Bestiary (JSON) from Disk" class="transition duration-150 p-1.5 text-black rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-black"> <svg class="h-6 w-6" fill="currentColor"><use href="#icon-import-bestiary"></use></svg>
                     </button>
                     <button id="exportBestiaryBtn" title="Export Bestiary (JSON) to Disk" class="transition duration-150 p-1.5 text-black rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-black"> <svg class="h-6 w-6" fill="currentColor"><use href="#icon-export-bestiary"></use></svg>
                     </button>
                 </div>

                 <div class="absolute bottom-0 left-0 right-0 h-[50px] bg-gradient-to-b from-black via-gray-500 to-black border border-black rounded-xl custom-shadow z-20 flex items-center justify-between px-4">
                     <h1 class="titlebar ml-40">npc Engineer</h1>
                     <div id="npc-buttons" class="flex items-center space-x-4">
                         <button id="newNpcBtn" title="New NPC" class="transition duration-150 p-1.5 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white"> <svg fill="currentColor" stroke="currentColor" stroke-width="0.5" class="h-5 w-5"><use href="#icon-new-npc"></use></svg>
                         </button>
                         <button id="duplicateNpcBtn" title="Duplicate this NPC." class="transition duration-150 p-1.5 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white disabled:opacity-25 disabled:cursor-not-allowed"> <svg class="h-5 w-5" fill="currentColor"><use href="#icon-duplicate-npc"></use></svg>
                         </button>
                         <button id="importNpcBtn" title="Import NPC" class="transition duration-150 p-1.5 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white disabled:opacity-25 disabled:cursor-not-allowed"> <svg class="h-5 w-5" fill="currentColor" stroke="currentColor" stroke-width="1"><use href="#icon-import-npc"></use></svg>
                         </button>
                         <button id="exportNpcBtn" title="Export NPC" class="transition duration-150 p-1.5 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white disabled:opacity-25 disabled:cursor-not-allowed"> <svg class="h-5 w-5" fill="currentColor" stroke="currentColor" stroke-width="1"><use href="#icon-export-npc"></use></svg>
                         </button>
                     </div>
                 </div>
                 <div id="footer-buttons-container" class="absolute left-0 pr-6 space-x-2" style="top: 105px; left: 290px; display: flex; align-items: center;">
                     <button id="footer-import-text-btn" class="btn-dark btn-xs" title="Import an NPC from copied text">Import NPC from Text</button>
                     <button id="footer-export-fg-btn" class="btn-dark btn-xs" title="Export the current bestiary for Fantasy Grounds">Export Bestiary to FG</button>
                 </div>
                 <div id="npc-selector-container" class="absolute right-0 pr-6" style="top: 100px; display: flex; justify-content: flex-end; align-items: center;">
                     <select id="npc-selector" class="info-select hidden" style="width: 450px; font-size: 11pt;" title="Select an NPC to edit"></select>
                     <button id="deleteNpcBtn" title="Delete Current NPC" class="ml-2 p-1.5 text-red-600 rounded-lg hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-red-500 hidden">
                         <svg class="h-5 w-5"><use href="#icon-trash"></use></svg>
                     </button>
                 </div>
             </div>
         </header>

         <nav id="quick-jump-menu" class="quick-jump-menu">
            <span id="quick-jump-title" class="quick-jump-title">Navigation</span>
            <ul>
               <li><a href="#info-card">NPC Info</a></li>
               <li><a href="#stats-card">Statistics</a></li>
               <li><a href="#speed-sense-card">Movement & Senses</a></li>
               <li><a href="#resist-card">Resistances</a></li>
               <li><a href="#skills-card">Skills</a></li>
               <li><a href="#lang-card">Languages</a></li>
               <li><a href="#traits-card">Traits</a></li>
               <li><a href="#spells-card">Spellcasting</a></li>
               <li><a href="#actions-card">Actions</a></li>
               <li><a href="#desc-card">Description</a></li>
               <li class="quick-jump-divider"><hr></li>
               <li class="quick-jump-setting">
                  <input type="checkbox" id="menu-solo-card-mode">
                  <label for="menu-solo-card-mode">Solo Card Mode</label>
               </li>
            </ul>
         </nav>

         <main class="flex flex-wrap justify-center gap-6 pt-6">

            <div id="main-content-column" class="w-[900px] flex-shrink-0 space-y-6">
					
               <div id="info-card" class="bg-white rounded-xl custom-shadow overflow-hidden bordered-container card-font-style">
                  <div class="card-header bg-[#F1FBEA] px-3 py-1 border-b border-black/20 flex justify-between items-center">
                     <h2 class="font-bold text-slate-700 cursor-pointer select-none" id="npc-info-header-title">NPC Information</h2>
                     <div class="flex items-center space-x-2">
                        <label for="fantasy-grounds-group" class="label-text text-xs">FG Group:</label>
                        <select id="fantasy-grounds-group" title="Select or manage the group this NPC will belong to in Fantasy Grounds exports." class="info-select h-6 text-xs" style="width: 150px;"></select>
                        <button id="manage-groups-btn" title="Manage Groups">
                           <svg class="h-5 w-5 text-gray-600 hover:text-black" fill="currentColor"><use href="#icon-manage"></use></svg>
                        </button>
                     </div>
                  </div>
                  <div class="card-body">
                     <div class="px-4 pt-2 pb-2">
                        <div class="flex space-x-4">
                           <div class="flex-shrink-0">
                              <div class="space-y-1">
                                 <div class="flex items-center mb-2">
                                    <label for="npc-name" class="label-text w-28 text-right pr-2">Name</label>
                                    <input type="text" id="npc-name" class="info-input" style="width: 250px; height: 23px; background-color: #fef2f2; border-color: #b91c1c;" tabindex="1" title="Enter the NPC's name." />
                                 </div>
                                 <div class="flex items-center">
                                    <label for="npc-size" class="label-text w-28 text-right pr-2">Size</label>
                                    <div class="relative" style="width: 200px; height: 23px;">
                                       <select id="npc-size" class="info-select absolute top-0 left-0 w-full h-full" tabindex="2" title="Select from the standard size categories or enter your own by clicking the checkbox.">
                                          <option value="" disabled selected hidden></option>
                                          <option>Tiny</option>
                                          <option>Small</option>
                                          <option>Medium</option>
                                          <option>Large</option>
                                          <option>Huge</option>
                                          <option>Gargantuan</option>
                                       </select>
                                       <input type="text" id="npc-size-custom" class="info-input absolute top-0 left-0 w-full h-full hidden" tabindex="2" title="Select from the standard size categories or enter your own by clicking the checkbox." />
                                    </div>
                                    <input type="checkbox" id="toggle-custom-size" title="enter a custom size" class="ml-2 mr-4 h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" tabindex="-1">
                                    <label for="npc-gender" class="label-text w-28 text-right pr-2">Gender</label>
                                    <select id="npc-gender" class="info-select" style="width: 130px; height: 23px;" tabindex="8" title="Select the NPC's gender.&#10;This will insert gender-specific pronouns in the descriptive text.">
                                       <option value="creature">creature</option>
                                       <option value="neutral">neutral</option>
                                       <option value="male">male</option>
                                       <option value="female">female</option>
                                    </select>
                                 </div>
                                 <div class="flex items-center">
                                    <label for="npc-type" class="label-text w-28 text-right pr-2">Type</label>
                                    <div class="relative" style="width: 200px; height: 23px;">
                                       <select id="npc-type" class="info-select absolute top-0 left-0 w-full h-full" tabindex="3" title="Select from the standard creature types or enter your own by clicking the checkbox.">
                                          <option value="" disabled selected hidden></option>
                                          <option>aberration</option>
                                          <option>beast</option>
                                          <option>celestial</option>
                                          <option>construct</option>
                                          <option>dragon</option>
                                          <option>elemental</option>
                                          <option>fey</option>
                                          <option>fiend</option>
                                          <option>giant</option>
                                          <option>humanoid</option>
                                          <option>monstrosity</option>
                                          <option>ooze</option>
                                          <option>plant</option>
                                          <option>undead</option>
                                          <option disabled>──────────</option>
                                          <option>swarm of tiny aberrations</option>
                                          <option>swarm of tiny beasts</option>
                                          <option>swarm of tiny constructs</option>
                                          <option>swarm of tiny elementals</option>
                                          <option>swarm of tiny monstrosities</option>
                                          <option>swarm of tiny oozes</option>
                                          <option>swarm of tiny plants</option>
                                          <option disabled>──────────</option>
                                          <option>trap</option>
                                       </select>
                                       <input type="text" id="npc-type-custom" class="info-input absolute top-0 left-0 w-full h-full hidden" tabindex="3" title="Select from the standard creature types or enter your own by clicking the checkbox." />
                                    </div>
                                    <input type="checkbox" id="toggle-custom-type" title="enter a custom type" class="ml-2 mr-4 h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" tabindex="-1">
                                    <label for="npc-unique" class="label-text w-28 text-right pr-2">Unique</label>
                                    <div class="w-[130px] flex items-center">
                                       <input type="checkbox" id="npc-unique" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" tabindex="9" title="Check if the NPC is unique for any reason.&#10;This will capitalise its name in the descriptive text.">
                                    </div>
                                 </div>
                                 <div class="flex items-center">
                                    <label for="npc-species" class="label-text w-28 text-right pr-2">Species</label>
                                    <div class="relative" style="width: 200px; height: 23px;">
                                       <select id="npc-species" class="info-select absolute top-0 left-0 w-full h-full" tabindex="4" title="Select a specific species or enter your own by clicking the checkbox.&#10;Example: a species of humanoid may be half-elf.&#10;You can leave this box blank if desired.">
                                          <option value="" disabled selected hidden></option>
                                          <option>aarakocra</option>
                                          <option>any species</option>
                                          <option>bullywug</option>
                                          <option>demon</option>
                                          <option>derro</option>
                                          <option>devil</option>
                                          <option>dragonborn</option>
                                          <option>dwarf</option>
                                          <option>elf</option>
                                          <option>firenewt</option>
                                          <option>genasi</option>
                                          <option>gith</option>
                                          <option>gnoll</option>
                                          <option>gnome</option>
                                          <option>goblinoid</option>
                                          <option>grimlock</option>
                                          <option>grung</option>
                                          <option>half-elf</option>
                                          <option>half-orc</option>
                                          <option>halfling</option>
                                          <option>human</option>
                                          <option>kenku</option>
                                          <option>kobold</option>
                                          <option>kuo-toa</option>
                                          <option>lizardfolk</option>
                                          <option>merfolk</option>
                                          <option>orc</option>
                                          <option>quaggoth</option>
                                          <option>ratfolk</option>
                                          <option>sahuagin</option>
                                          <option>shapechanger</option>
                                          <option>thri-kreen</option>
                                          <option>tiefling</option>
                                          <option>titan</option>
                                          <option>troglodyte</option>
                                          <option>xvart</option>
                                          <option>yuan-ti</option>
                                          <option>yugoloth</option>
                                       </select>
                                       <input type="text" id="npc-species-custom" class="info-input absolute top-0 left-0 w-full h-full hidden" tabindex="4" title="Select a specific species or enter your own by clicking the checkbox.&#10;Example: a species of humanoid may be half-elf.&#10;You can leave this box blank if desired." />
                                    </div>
                                    <input type="checkbox" id="toggle-custom-species" title="enter a custom species" class="ml-2 mr-4 h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" tabindex="-1">
                                    <label for="npc-proper" class="label-text w-28 text-right pr-2">Proper Name</label>
                                    <div class="w-[130px] flex items-center">
                                       <input type="checkbox" id="npc-proper" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" tabindex="10" title="Check if the name entered is a proper name.&#10;This will use just the first word of the name in the descriptive text.&#10;('Maasq Hammerheart' will be referred to as 'Maasq' throughout; 'Ironbane, Destroyer of Worlds' as 'Ironbane') ">
                                    </div>
                                 </div>
                                 <div class="flex items-start">
                                    <div class="space-y-1">
                                       <div class="flex items-center">
                                          <label for="npc-alignment" class="label-text w-28 text-right pr-2">Alignment</label>
                                          <div class="relative" style="width: 200px; height: 23px;">
                                             <select id="npc-alignment" class="info-select absolute top-0 left-0 w-full h-full" tabindex="5" title="Select from the standard alignments or enter your own by clicking the checkbox.">
                                                <option value="" disabled selected hidden></option>
                                                <option>unaligned</option>
                                                <option disabled>──────────</option>
                                                <option>lawful good</option>
                                                <option>lawful neutral</option>
                                                <option>lawful evil</option>
                                                <option disabled>──────────</option>
                                                <option>neutral good</option>
                                                <option>true neutral</option>
                                                <option>neutral evil</option>
                                                <option disabled>──────────</option>
                                                <option>chaotic good</option>
                                                <option>chaotic neutral</option>
                                                <option>chaotic evil</option>
                                             </select>
                                             <input type="text" id="npc-alignment-custom" class="info-input absolute top-0 left-0 w-full h-full hidden" tabindex="5" title="Select from the standard alignments or enter your own by clicking the checkbox.">
                                          </div>
                                          <input type="checkbox" id="toggle-custom-alignment" title="enter a custom alignment" class="ml-2 mr-4 h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" tabindex="-1">
                                       </div>
                                       <div class="flex items-center">
                                          <label for="npc-ac" class="label-text w-28 text-right pr-2">Armor Class</label>
                                          <input type="text" id="npc-ac" class="info-input" style="width: 200px; height: 23px;" tabindex="6" title="Enter the NPC's armor class. You can also enter the type of armor in brackets.&#10;Example: 12 (leather armor)">
                                       </div>
                                       <div class="flex items-center">
                                          <label for="npc-hp" class="label-text w-28 text-right pr-2">Hit Points</label>
                                          <input type="text" id="npc-hp" class="info-input" style="width: 200px; height: 23px;" tabindex="7" title="Enter the NPC's hit points, followed by its hit dice in brackets.&#10;Example: 16 (3d6 + 6)&#10;Double-click to open a window that will help build a correct expression.">
                                       </div>
                                       <div class="flex items-center" style="padding-top: 3px;">
                                          <label for="npc-challenge" class="label-text w-28 text-right pr-2">Challenge</label>
                                          <select id="npc-challenge" title="Select the NPC's Challenge Rating (CR). This determines XP value and default Proficiency Bonus." class="info-select" style="width: 70px; height: 23px;" tabindex="8"></select>
                                       </div>
                                       <div class="flex items-center" style="margin-top: -1px;">
                                          <label class="label-text w-28 text-right pr-2">XP</label>
                                          <span id="npc-experience-display" class="font-medium text-gray-800" style="width: 80px;"></span>
                                          <label class="label-text pr-2 ml-2">Proficiency Bonus</label>
                                          <span id="npc-proficiency-bonus-display" class="font-medium text-gray-800"></span>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           </div>

                           <div class="flex-grow">
                              <div id="npc-image" title="NPC Image" class="w-[256px] h-[256px] info-input cursor-pointer flex items-center justify-center text-gray-400 text-xs text-center overflow-hidden">
                                 <span>Click or Drag an NPC Image Here</span>
                              </div>
                              <input type="file" id="image-upload" class="hidden" accept="image/png, image/webp, image/jpeg">
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               
               <div id="fg-specific-card" class="bg-white rounded-xl custom-shadow overflow-hidden bordered-container card-font-style">
                  <div class="card-header bg-[#F1FBEA] px-3 py-1 border-b border-black/20 cursor-pointer select-none">
                     <h2 class="font-bold text-slate-700 relative" style="top: 0px;">Fantasy Grounds Specific</h2>
                  </div>
                  <div class="card-body">
                     <div class="px-4 pt-2 pb-2">
                        <div class="flex space-x-4">
                           <!-- Left Column: Inputs -->
                           <div class="flex-grow space-y-2">
                              <div class="flex items-start space-x-2">
                                 <label for="npc-non-id" class="label-text w-40 text-right flex-shrink-0 mt-1">Non ID Information</label>
                                 <textarea id="npc-non-id" class="info-input w-full" rows="2" title="The text to show in the Combat Tracker when the NPC has not yet been identified."></textarea>
                              </div>
                              <div class="flex items-center space-x-2">
                                 <label for="npc-damage-threshold" class="label-text w-40 text-right flex-shrink-0">Damage Threshold</label>
                                 <input type="number" id="npc-damage-threshold" class="info-input w-24" value="0" min="0" title="If the damage done by any attack is less than this threshold, the damage is ignored completely.&#10;Usually only used by traps and structures, but can also be added to creatures.">
                              </div>
                           </div>
                           <!-- Right Column: Image Boxes -->
                           <div class="flex-shrink-0 flex space-x-4 items-end">
                              <!-- Moved Token Box -->
                              <div class="flex">
                                 <div class="w-[130px]">
                                    <div id="npc-token" title="NPC Token" class="w-[130px] h-[130px] info-input cursor-pointer flex items-center justify-center text-gray-400 text-xs text-center overflow-hidden">
                                       <span>Click or Drag a Token Image Here</span>
                                    </div>
                                    <input type="file" id="token-upload" class="hidden" accept="image/png, image/webp">
                                 </div>
                              </div>
                              <!-- New Camera Token Box -->
                              <div class="flex">
                                 <div class="w-[256px]">
                                    <div id="npc-camera-token" title="NPC Camera Token" class="w-[256px] h-[242px] info-input cursor-pointer flex items-center justify-center text-gray-400 text-xs text-center overflow-hidden">
                                       <span>Click or Drag a Camera Token Image Here</span>
                                    </div>
                                    <input type="file" id="camera-token-upload" class="hidden" accept="image/png, image/webp, image/jpeg">
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>

               <div id="stats-card" class="bg-white rounded-xl custom-shadow overflow-hidden bordered-container card-font-style">
                  <div class="card-header bg-[#F1FBEA] px-3 py-1 border-b border-black/20 cursor-pointer select-none">
                     <h2 class="font-bold text-slate-700 relative" style="top: 0px;">Statistics</h2>
                  </div>
                  <div class="card-body">
                     <div class="p-4">
                        <div class="flex justify-around">
                           <div class="ml-12">
                              <h3 class="font-bold text-center ml-9 mb-1 text-gray-800">Ability Scores</h3>
                              <div class="flex space-x-2">
                                 <div class="flex flex-col items-end space-y-1">
                                    <label class="label-text font-semibold h-6 mb-1 stat-header">Ability</label>
                                    <label for="npc-strength" class="label-text h-6 flex items-center">Strength</label>
                                    <label for="npc-dexterity" class="label-text h-6 flex items-center">Dexterity</label>
                                    <label for="npc-constitution" class="label-text h-6 flex items-center">Constitution</label>
                                    <label for="npc-intelligence" class="label-text h-6 flex items-center">Intelligence</label>
                                    <label for="npc-wisdom" class="label-text h-6 flex items-center">Wisdom</label>
                                    <label for="npc-charisma" class="label-text h-6 flex items-center">Charisma</label>
                                 </div>
                                 <div class="flex flex-col items-center space-y-1">
                                    <label class="label-text font-semibold h-6 mb-1 stat-header">Score</label>
                                    <input type="number" id="npc-strength" title="Enter the NPC's Strength score (1-30). Bonus is calculated automatically." class="info-input h-6" style="width: 41px; padding-right: 2px;" min="1" max="30">
                                    <input type="number" id="npc-dexterity" title="Enter the NPC's Dexterity score (1-30). Bonus is calculated automatically." class="info-input h-6" style="width: 41px; padding-right: 2px;" min="1" max="30">
                                    <input type="number" id="npc-constitution" title="Enter the NPC's Constitution score (1-30). Bonus is calculated automatically." class="info-input h-6" style="width: 41px; padding-right: 2px;" min="1" max="30">
                                    <input type="number" id="npc-intelligence" title="Enter the NPC's Intelligence score (1-30). Bonus is calculated automatically." class="info-input h-6" style="width: 41px; padding-right: 2px;" min="1" max="30">
                                    <input type="number" id="npc-wisdom" title="Enter the NPC's Wisdom score (1-30). Bonus is calculated automatically." class="info-input h-6" style="width: 41px; padding-right: 2px;" min="1" max="30">
                                    <input type="number" id="npc-charisma" title="Enter the NPC's Charisma score (1-30). Bonus is calculated automatically." class="info-input h-6" style="width: 41px; padding-right: 2px;" min="1" max="30">
                                 </div>
                                 <div class="flex flex-col items-center space-y-1">
                                    <label class="label-text font-semibold h-6 mb-1 stat-header">Bonus</label>
                                    <span id="npc-strength-bonus" class="font-medium text-gray-800 h-6 flex items-center"></span>
                                    <span id="npc-dexterity-bonus" class="font-medium text-gray-800 h-6 flex items-center"></span>
                                    <span id="npc-constitution-bonus" class="font-medium text-gray-800 h-6 flex items-center"></span>
                                    <span id="npc-intelligence-bonus" class="font-medium text-gray-800 h-6 flex items-center"></span>
                                    <span id="npc-wisdom-bonus" class="font-medium text-gray-800 h-6 flex items-center"></span>
                                    <span id="npc-charisma-bonus" class="font-medium text-gray-800 h-6 flex items-center"></span>
                                 </div>
                              </div>
                           </div>

                           <div class="mr-12">
                              <h3 class="font-bold text-center mb-1 text-gray-800">Saving Throws</h3>
                              <div class="flex space-x-2">
                                 <div class="flex flex-col items-center space-y-1">
                                    <label class="label-text font-semibold h-6 mb-1 text-center stat-header" style="width: 60px;">Prof</label>
                                    <div class="h-6 flex items-center justify-center w-full"><input type="checkbox" id="npc-strength-saving-throw-prof" title="Add proficiency in strength saving throws?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                    <div class="h-6 flex items-center justify-center w-full"><input type="checkbox" id="npc-dexterity-saving-throw-prof" title="Add proficiency in dexterity saving throws?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                    <div class="h-6 flex items-center justify-center w-full"><input type="checkbox" id="npc-constitution-saving-throw-prof" title="Add proficiency in constitution saving throws?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                    <div class="h-6 flex items-center justify-center w-full"><input type="checkbox" id="npc-intelligence-saving-throw-prof" title="Add proficiency in intelligence saving throws?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                    <div class="h-6 flex items-center justify-center w-full"><input type="checkbox" id="npc-wisdom-saving-throw-prof" title="Add proficiency in wisdom saving throws?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                    <div class="h-6 flex items-center justify-center w-full"><input type="checkbox" id="npc-charisma-saving-throw-prof" title="Add proficiency in charisma saving throws?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 </div>
                                 <div class="flex flex-col items-center space-y-1">
                                    <label class="label-text font-semibold h-6 mb-1 text-center stat-header" style="width: 50px;">Adjust</label>
                                    <input type="number" id="npc-strength-saving-throw-adjust" title="Manually adjust the saving throw bonus (e.g., +1, -2)." class="info-input h-6" style="width: 41px; padding-right: 2px;" min="-9" max="9">
                                    <input type="number" id="npc-dexterity-saving-throw-adjust" title="Manually adjust the saving throw bonus (e.g., +1, -2)." class="info-input h-6" style="width: 41px; padding-right: 2px;" min="-9" max="9">
                                    <input type="number" id="npc-constitution-saving-throw-adjust" title="Manually adjust the saving throw bonus (e.g., +1, -2)." class="info-input h-6" style="width: 41px; padding-right: 2px;" min="-9" max="9">
                                    <input type="number" id="npc-intelligence-saving-throw-adjust" title="Manually adjust the saving throw bonus (e.g., +1, -2)." class="info-input h-6" style="width: 41px; padding-right: 2px;" min="-9" max="9">
                                    <input type="number" id="npc-wisdom-saving-throw-adjust" title="Manually adjust the saving throw bonus (e.g., +1, -2)." class="info-input h-6" style="width: 41px; padding-right: 2px;" min="-9" max="9">
                                    <input type="number" id="npc-charisma-saving-throw-adjust" title="Manually adjust the saving throw bonus (e.g., +1, -2)." class="info-input h-6" style="width: 41px; padding-right: 2px;" min="-9" max="9">
                                 </div>
                                 <div class="flex flex-col items-center space-y-1">
                                    <label class="label-text font-semibold h-6 mb-1 text-center stat-header" style="width: 50px;">Total</label>
                                    <span id="npc-strength-saving-throw-total" class="font-medium text-gray-800 h-6 flex items-center justify-center w-full"></span>
                                    <span id="npc-dexterity-saving-throw-total" class="font-medium text-gray-800 h-6 flex items-center justify-center w-full"></span>
                                    <span id="npc-constitution-saving-throw-total" class="font-medium text-gray-800 h-6 flex items-center justify-center w-full"></span>
                                    <span id="npc-intelligence-saving-throw-total" class="font-medium text-gray-800 h-6 flex items-center justify-center w-full"></span>
                                    <span id="npc-wisdom-saving-throw-total" class="font-medium text-gray-800 h-6 flex items-center justify-center w-full"></span>
                                    <span id="npc-charisma-saving-throw-total" class="font-medium text-gray-800 h-6 flex items-center justify-center w-full"></span>
                                 </div>
                              </div>
                           </div>

                        </div>
                     </div>
                  </div>
               </div>

               <div id="speed-sense-card" class="bg-white rounded-xl custom-shadow overflow-hidden bordered-container card-font-style">
                  <div class="card-header bg-[#F1FBEA] px-3 py-1 border-b border-black/20 cursor-pointer select-none">
                     <h2 class="font-bold text-slate-700 relative" style="top: 0px;">Movement Speed and Sense Ranges</h2>
                  </div>
                  <div class="card-body">
                     <div class="p-4">
                        <div class="flex justify-around">
                           <div>
                              <h3 class="font-bold text-center mb-1 text-gray-800">Speeds (ft.)</h3>
                              <div class="flex items-center space-x-2 mb-1">
                                 <label for="npc-speed-base" class="label-text w-24 text-right whitespace-nowrap">Base Speed</label>
                                 <input type="number" id="npc-speed-base" title="Enter the NPC's base walking speed in feet." class="info-input h-6 w-20 text-center" min="0" max="200" step="5">
                              </div>
                              <div class="flex items-center space-x-2 mb-1">
                                 <label for="npc-speed-burrow" class="label-text w-24 text-right">Burrow</label>
                                 <input type="number" id="npc-speed-burrow" title="Enter the NPC's burrow speed in feet." class="info-input h-6 w-20 text-center" min="0" max="200" step="5">
                              </div>
                              <div class="flex items-center space-x-2 mb-1">
                                 <label for="npc-speed-climb" class="label-text w-24 text-right">Climb</label>
                                 <input type="number" id="npc-speed-climb" title="Enter the NPC's climb speed in feet." class="info-input h-6 w-20 text-center" min="0" max="200" step="5">
                              </div>
                              <div class="flex items-center space-x-2 mb-1">
                                 <label for="npc-speed-fly" class="label-text w-24 text-right">Fly</label>
                                 <input type="number" id="npc-speed-fly" title="Enter the NPC's fly speed in feet." class="info-input h-6 w-20 text-center" min="0" max="200" step="5">
                                 <div class="w-28 flex items-center ml-4">
                                    <input type="checkbox" id="npc-fly-hover" title="Check if the NPC can hover while flying." class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                    <label for="npc-fly-hover" class="label-text ml-2">Hover</label>
                                 </div>
                              </div>
                              <div class="flex items-center space-x-2 mb-1">
                                 <label for="npc-speed-swim" class="label-text w-24 text-right">Swim</label>
                                 <input type="number" id="npc-speed-swim" title="Enter the NPC's swim speed in feet." class="info-input h-6 w-20 text-center" min="0" max="200" step="5">
                              </div>
                           </div>
                           <div>
                              <h3 class="font-bold text-center mb-1 text-gray-800">Senses (ft.)</h3>
                              <div class="flex items-center space-x-2 mb-1">
                                 <label for="npc-sense-blindsight" class="label-text w-36 text-right">Blindsight</label>
                                 <input type="number" id="npc-sense-blindsight" title="Enter the range of the NPC's blindsight in feet." class="info-input h-6 w-20 text-center" min="0" max="600" step="10">
                                 <div class="w-32 flex items-center ml-4">
                                    <input type="checkbox" id="npc-blind-beyond" title="Check if the NPC is blind beyond its blindsight radius." class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                    <label for="npc-blind-beyond" class="label-text ml-2">Blind Beyond</label>
                                 </div>
                              </div>
                              <div class="flex items-center space-x-2 mb-1">
                                 <label for="npc-sense-darkvision" class="label-text w-36 text-right">Darkvision</label>
                                 <input type="number" id="npc-sense-darkvision" title="Enter the range of the NPC's darkvision in feet." class="info-input h-6 w-20 text-center" min="0" max="600" step="10">
                              </div>
                              <div class="flex items-center space-x-2 mb-1">
                                 <label for="npc-sense-tremorsense" class="label-text w-36 text-right">Tremorsense</label>
                                 <input type="number" id="npc-sense-tremorsense" title="Enter the range of the NPC's tremorsense in feet." class="info-input h-6 w-20 text-center" min="0" max="600" step="10">
                              </div>
                              <div class="flex items-center space-x-2 mb-1">
                                 <label for="npc-sense-truesight" class="label-text w-36 text-right">Truesight</label>
                                 <input type="number" id="npc-sense-truesight" title="Enter the range of the NPC's truesight in feet." class="info-input h-6 w-20 text-center" min="0" max="600" step="10">
                              </div>
                              <div class="flex items-center space-x-2 mt-2">
                                 <label class="label-text w-36 text-right font-semibold whitespace-nowrap">Passive Perception</label>
                                 <span id="npc-passive-perception" title="Passive Perception score (10 + Perception bonus). Automatically calculated." class="font-medium text-gray-800 h-6 flex items-center justify-center w-20"></span>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>

               <div id="resist-card" class="bg-white rounded-xl custom-shadow overflow-hidden bordered-container card-font-style">
                  <div class="card-header bg-[#F1FBEA] px-3 py-1 border-b border-black/20 cursor-pointer select-none">
                     <h2 class="font-bold text-slate-700 relative" style="top: 0px;">Resistances</h2>
                  </div>
                  <div class="card-body">
                     <div class="p-4">
                        <div class="relative mt-2">
                           <h3 class="font-bold text-gray-800 absolute -top-2.5 left-4 bg-white px-1">Vulnerability</h3>
                           <div class="border border-gray-400 rounded-lg p-3 pt-4">
                              <div class="flex justify-between items-start">
                                 <div class="flex flex-col items-center text-center px-1"><label for="vuln-acid" class="label-text text-[8pt] leading-tight">Acid</label><input type="checkbox" id="vuln-acid" title="Vulnerable to Acid damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="vuln-cold" class="label-text text-[8pt] leading-tight">Cold</label><input type="checkbox" id="vuln-cold" title="Vulnerable to Cold damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="vuln-fire" class="label-text text-[8pt] leading-tight">Fire</label><input type="checkbox" id="vuln-fire" title="Vulnerable to Fire damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="vuln-force" class="label-text text-[8pt] leading-tight">Force</label><input type="checkbox" id="vuln-force" title="Vulnerable to Force damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="vuln-lightning" class="label-text text-[8pt] leading-tight">Lightning</label><input type="checkbox" id="vuln-lightning" title="Vulnerable to Lightning damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="vuln-necrotic" class="label-text text-[8pt] leading-tight">Necrotic</label><input type="checkbox" id="vuln-necrotic" title="Vulnerable to Necrotic damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="vuln-poison" class="label-text text-[8pt] leading-tight">Poison</label><input type="checkbox" id="vuln-poison" title="Vulnerable to Poison damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="vuln-psychic" class="label-text text-[8pt] leading-tight">Psychic</label><input type="checkbox" id="vuln-psychic" title="Vulnerable to Psychic damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="vuln-radiant" class="label-text text-[8pt] leading-tight">Radiant</label><input type="checkbox" id="vuln-radiant" title="Vulnerable to Radiant damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="vuln-thunder" class="label-text text-[8pt] leading-tight">Thunder</label><input type="checkbox" id="vuln-thunder" title="Vulnerable to Thunder damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="vuln-bludgeoning" class="label-text text-[8pt] leading-tight">Bludgeoning</label><input type="checkbox" id="vuln-bludgeoning" title="Vulnerable to Bludgeoning damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="vuln-piercing" class="label-text text-[8pt] leading-tight">Piercing</label><input type="checkbox" id="vuln-piercing" title="Vulnerable to Piercing damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="vuln-slashing" class="label-text text-[8pt] leading-tight">Slashing</label><input type="checkbox" id="vuln-slashing" title="Vulnerable to Slashing damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                              </div>
                           </div>
                        </div>

                        <div class="relative mt-6">
                           <h3 class="font-bold text-gray-800 absolute -top-2.5 left-4 bg-white px-1">Resistance</h3>
                           <div class="border border-gray-400 rounded-lg p-3 pt-4">
                              <div class="flex justify-between items-start">
                                 <div class="flex flex-col items-center text-center px-1"><label for="res-acid" class="label-text text-[8pt] leading-tight">Acid</label><input type="checkbox" id="res-acid" title="Resistant to Acid damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="res-cold" class="label-text text-[8pt] leading-tight">Cold</label><input type="checkbox" id="res-cold" title="Resistant to Cold damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="res-fire" class="label-text text-[8pt] leading-tight">Fire</label><input type="checkbox" id="res-fire" title="Resistant to Fire damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="res-force" class="label-text text-[8pt] leading-tight">Force</label><input type="checkbox" id="res-force" title="Resistant to Force damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="res-lightning" class="label-text text-[8pt] leading-tight">Lightning</label><input type="checkbox" id="res-lightning" title="Resistant to Lightning damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="res-necrotic" class="label-text text-[8pt] leading-tight">Necrotic</label><input type="checkbox" id="res-necrotic" title="Resistant to Necrotic damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="res-poison" class="label-text text-[8pt] leading-tight">Poison</label><input type="checkbox" id="res-poison" title="Resistant to Poison damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="res-psychic" class="label-text text-[8pt] leading-tight">Psychic</label><input type="checkbox" id="res-psychic" title="Resistant to Psychic damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="res-radiant" class="label-text text-[8pt] leading-tight">Radiant</label><input type="checkbox" id="res-radiant" title="Resistant to Radiant damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="res-thunder" class="label-text text-[8pt] leading-tight">Thunder</label><input type="checkbox" id="res-thunder" title="Resistant to Thunder damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="res-bludgeoning" class="label-text text-[8pt] leading-tight">Bludgeoning</label><input type="checkbox" id="res-bludgeoning" title="Resistant to Bludgeoning damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="res-piercing" class="label-text text-[8pt] leading-tight">Piercing</label><input type="checkbox" id="res-piercing" title="Resistant to Piercing damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="res-slashing" class="label-text text-[8pt] leading-tight">Slashing</label><input type="checkbox" id="res-slashing" title="Resistant to Slashing damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                              </div>
                              <div class="mt-4 pt-2 border-t border-gray-300">
                                 <div class="flex flex-col space-y-1 text-sm">
                                    <div class="flex items-center">
                                       <input type="radio" id="wr-none" name="weapon-resistance" value="none" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                       <label for="wr-none" class="ml-2 label-text">No special weapon resistances.</label>
                                    </div>
                                    <div class="flex items-center">
<input type="radio" id="wr-nonmagical" name="weapon-resistance" value="nonmagical" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                       <label for="wr-nonmagical" class="ml-2 label-text">Resistant to nonmagical weapons.</label>
                                    </div>
                                    <div class="flex items-center">
                                       <input type="radio" id="wr-silvered" name="weapon-resistance" value="silvered" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                       <label for="wr-silvered" class="ml-2 label-text">Resistant to nonmagical weapons that aren't silvered.</label>
                                    </div>
                                    <div class="flex items-center">
                                       <input type="radio" id="wr-adamantine" name="weapon-resistance" value="adamantine" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                       <label for="wr-adamantine" class="ml-2 label-text">Resistant to nonmagical weapons that aren't adamantine.</label>
                                    </div>
                                    <div class="flex items-center">
                                       <input type="radio" id="wr-cold-forged" name="weapon-resistance" value="cold-forged" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                       <label for="wr-cold-forged" class="ml-2 label-text">Resistant to nonmagical weapons that aren't cold-forged iron.</label>
                                    </div>
                                    <div class="flex items-center">
                                       <input type="radio" id="wr-magical" name="weapon-resistance" value="magical" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                       <label for="wr-magical" class="ml-2 label-text">Resistant to magical weapons.</label>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>

                        <div class="relative mt-6">
                           <h3 class="font-bold text-gray-800 absolute -top-2.5 left-4 bg-white px-1">Immunity</h3>
                           <div class="border border-gray-400 rounded-lg p-3 pt-4">
                              <div class="flex justify-between items-start">
                                 <div class="flex flex-col items-center text-center px-1"><label for="imm-acid" class="label-text text-[8pt] leading-tight">Acid</label><input type="checkbox" id="imm-acid" title="Immune to Acid damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="imm-cold" class="label-text text-[8pt] leading-tight">Cold</label><input type="checkbox" id="imm-cold" title="Immune to Cold damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="imm-fire" class="label-text text-[8pt] leading-tight">Fire</label><input type="checkbox" id="imm-fire" title="Immune to Fire damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="imm-force" class="label-text text-[8pt] leading-tight">Force</label><input type="checkbox" id="imm-force" title="Immune to Force damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="imm-lightning" class="label-text text-[8pt] leading-tight">Lightning</label><input type="checkbox" id="imm-lightning" title="Immune to Lightning damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="imm-necrotic" class="label-text text-[8pt] leading-tight">Necrotic</label><input type="checkbox" id="imm-necrotic" title="Immune to Necrotic damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="imm-poison" class="label-text text-[8pt] leading-tight">Poison</label><input type="checkbox" id="imm-poison" title="Immune to Poison damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="imm-psychic" class="label-text text-[8pt] leading-tight">Psychic</label><input type="checkbox" id="imm-psychic" title="Immune to Psychic damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="imm-radiant" class="label-text text-[8pt] leading-tight">Radiant</label><input type="checkbox" id="imm-radiant" title="Immune to Radiant damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="imm-thunder" class="label-text text-[8pt] leading-tight">Thunder</label><input type="checkbox" id="imm-thunder" title="Immune to Thunder damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="imm-bludgeoning" class="label-text text-[8pt] leading-tight">Bludgeoning</label><input type="checkbox" id="imm-bludgeoning" title="Immune to Bludgeoning damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="imm-piercing" class="label-text text-[8pt] leading-tight">Piercing</label><input type="checkbox" id="imm-piercing" title="Immune to Piercing damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                                 <div class="flex flex-col items-center text-center px-1"><label for="imm-slashing" class="label-text text-[8pt] leading-tight">Slashing</label><input type="checkbox" id="imm-slashing" title="Immune to Slashing damage?" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></div>
                              </div>
                              <div class="mt-4 pt-2 border-t border-gray-300">
                                 <div class="flex flex-col space-y-1 text-sm">
                                    <div class="flex items-center">
                                       <input type="radio" id="wi-none" name="weapon-immunity" value="none" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                       <label for="wi-none" class="ml-2 label-text">No special weapon immunities.</label>
                                    </div>
                                    <div class="flex items-center">
                                       <input type="radio" id="wi-nonmagical" name="weapon-immunity" value="nonmagical" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                       <label for="wi-nonmagical" class="ml-2 label-text">Immune to nonmagical weapons.</label>
                                    </div>
									<div class="flex items-center">
                                       <input type="radio" id="wi-silvered" name="weapon-immunity" value="silvered" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                       <label for="wi-silvered" class="ml-2 label-text">Immune to nonmagical weapons that aren't silvered.</label>
                                    </div>
                                    <div class="flex items-center">
                                       <input type="radio" id="wi-adamantine" name="weapon-immunity" value="adamantine" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                       <label for="wi-adamantine" class="ml-2 label-text">Immune to nonmagical weapons that aren't adamantine.</label>
                                    </div>
                                    <div class="flex items-center">
                                       <input type="radio" id="wi-cold-forged" name="weapon-immunity" value="cold-forged" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                       <label for="wi-cold-forged" class="ml-2 label-text">Immune to nonmagical weapons that aren't cold-forged iron.</label>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>

                        <div class="relative mt-6">
                           <h3 class="font-bold text-gray-800 absolute -top-2.5 left-4 bg-white px-1">Condition Immunity</h3>
                           <div class="border border-gray-400 rounded-lg p-4 pt-5">
                              <div class="grid grid-cols-3 gap-x-8 gap-y-1 text-sm">
                                 <div class="flex items-center"><input type="checkbox" id="ci-blinded" title="Immune to the Blinded condition?" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500"><label for="ci-blinded" class="ml-2 label-text">blinded</label></div>
                                 <div class="flex items-center"><input type="checkbox" id="ci-charmed" title="Immune to the Charmed condition?" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500"><label for="ci-charmed" class="ml-2 label-text">charmed</label></div>
                                 <div class="flex items-center"><input type="checkbox" id="ci-deafened" title="Immune to the Deafened condition?" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500"><label for="ci-deafened" class="ml-2 label-text">deafened</label></div>
                                 <div class="flex items-center"><input type="checkbox" id="ci-exhaustion" title="Immune to the Exhaustion condition?" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500"><label for="ci-exhaustion" class="ml-2 label-text">exhaustion</label></div>
                                 <div class="flex items-center"><input type="checkbox" id="ci-frightened" title="Immune to the Frightened condition?" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500"><label for="ci-frightened" class="ml-2 label-text">frightened</label></div>
                                 <div class="flex items-center"><input type="checkbox" id="ci-grappled" title="Immune to the Grappled condition?" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500"><label for="ci-grappled" class="ml-2 label-text">grappled</label></div>
                                 <div class="flex items-center"><input type="checkbox" id="ci-incapacitated" title="Immune to the Incapacitated condition?" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500"><label for="ci-incapacitated" class="ml-2 label-text">incapacitated</label></div>
                                 <div class="flex items-center"><input type="checkbox" id="ci-invisible" title="Immune to the Invisible condition?" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500"><label for="ci-invisible" class="ml-2 label-text">invisible</label></div>
                                 <div class="flex items-center"><input type="checkbox" id="ci-paralyzed" title="Immune to the Paralyzed condition?" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500"><label for="ci-paralyzed" class="ml-2 label-text">paralyzed</label></div>
                                 <div class="flex items-center"><input type="checkbox" id="ci-petrified" title="Immune to the Petrified condition?" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500"><label for="ci-petrified" class="ml-2 label-text">petrified</label></div>
                                 <div class="flex items-center"><input type="checkbox" id="ci-poisoned" title="Immune to the Poisoned condition?" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500"><label for="ci-poisoned" class="ml-2 label-text">poisoned</label></div>
                                 <div class="flex items-center"><input type="checkbox" id="ci-prone" title="Immune to the Prone condition?" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500"><label for="ci-prone" class="ml-2 label-text">prone</label></div>
                                 <div class="flex items-center"><input type="checkbox" id="ci-restrained" title="Immune to the Restrained condition?" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500"><label for="ci-restrained" class="ml-2 label-text">restrained</label></div>
                                 <div class="flex items-center"><input type="checkbox" id="ci-stunned" title="Immune to the Stunned condition?" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500"><label for="ci-stunned" class="ml-2 label-text">stunned</label></div>
                                 <div class="flex items-center"><input type="checkbox" id="ci-unconscious" title="Immune to the Unconscious condition?" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500"><label for="ci-unconscious" class="ml-2 label-text">unconscious</label></div>
                              </div>
                           </div>
                        </div>

                     </div>
                  </div>
               </div>

               <div id="skills-card" class="bg-white rounded-xl custom-shadow overflow-hidden bordered-container card-font-style">
                  <div class="card-header bg-[#F1FBEA] px-3 py-1 border-b border-black/20 cursor-pointer select-none">
                     <h2 class="font-bold text-slate-700 relative" style="top: 0px;">Skills</h2>
                  </div>
                  <div class="card-body">
                     <div class="p-4 grid grid-cols-2 gap-x-8">
                        <div class="space-y-1">
                           <div class="flex items-center font-semibold text-xs text-gray-500 mb-1">
                              <span class="w-28 text-left">Skill</span>
                              <span class="w-10 text-center">Attr</span>
                              <span class="w-8 text-center">Prof</span>
                              <span class="w-8 text-center">Exp</span>
                              <span class="w-16 text-center">Adjust</span>
                              <span class="w-12 text-center">Total</span>
                           </div>
                           <div class="skill-row flex items-center h-6" data-skill="acrobatics" data-attr="dexterity">
                              <label for="skill-acrobatics-prof" class="w-28 text-sm">Acrobatics</label><span class="w-10 text-center text-xs text-gray-500">(DEX)</span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-acrobatics-prof" class="skill-prof h-4 w-4" title="Check this box if the NPC has proficiency in Acrobatics."></span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-acrobatics-exp" class="skill-exp h-4 w-4" title="Check this box if the NPC has expertise in Acrobatics."></span>
                              <input type="number" id="skill-acrobatics-adjust" class="info-input h-5 w-16 text-center skill-adjust" min="-5" max="5" value="0" title="Any other adjustments to the bonus for Acrobatics.">
                              <span id="skill-acrobatics-total" class="w-12 text-center font-bold text-gray-800 skill-total"></span>
                           </div>
                           <div class="skill-row flex items-center h-6" data-skill="animal_handling" data-attr="wisdom">
                              <label for="skill-animal_handling-prof" class="w-28 text-sm">Animal Handling</label><span class="w-10 text-center text-xs text-gray-500">(WIS)</span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-animal_handling-prof" class="skill-prof h-4 w-4" title="Check this box if the NPC has proficiency in Animal Handling."></span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-animal_handling-exp" class="skill-exp h-4 w-4" title="Check this box if the NPC has expertise in Animal Handling."></span>
                              <input type="number" id="skill-animal_handling-adjust" class="info-input h-5 w-16 text-center skill-adjust" min="-5" max="5" value="0" title="Any other adjustments to the bonus for Animal Handling.">
                              <span id="skill-animal_handling-total" class="w-12 text-center font-bold text-gray-800 skill-total"></span>
                           </div>
                           <div class="skill-row flex items-center h-6" data-skill="arcana" data-attr="intelligence">
                              <label for="skill-arcana-prof" class="w-28 text-sm">Arcana</label><span class="w-10 text-center text-xs text-gray-500">(INT)</span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-arcana-prof" class="skill-prof h-4 w-4" title="Check this box if the NPC has proficiency in Arcana."></span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-arcana-exp" class="skill-exp h-4 w-4" title="Check this box if the NPC has expertise in Arcana."></span>
                              <input type="number" id="skill-arcana-adjust" class="info-input h-5 w-16 text-center skill-adjust" min="-5" max="5" value="0" title="Any other adjustments to the bonus for Arcana.">
                              <span id="skill-arcana-total" class="w-12 text-center font-bold text-gray-800 skill-total"></span>
                           </div>
                           <div class="skill-row flex items-center h-6" data-skill="athletics" data-attr="strength">
                              <label for="skill-athletics-prof" class="w-28 text-sm">Athletics</label><span class="w-10 text-center text-xs text-gray-500">(STR)</span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-athletics-prof" class="skill-prof h-4 w-4" title="Check this box if the NPC has proficiency in Athletics."></span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-athletics-exp" class="skill-exp h-4 w-4" title="Check this box if the NPC has expertise in Athletics."></span>
                              <input type="number" id="skill-athletics-adjust" class="info-input h-5 w-16 text-center skill-adjust" min="-5" max="5" value="0" title="Any other adjustments to the bonus for Athletics.">
                              <span id="skill-athletics-total" class="w-12 text-center font-bold text-gray-800 skill-total"></span>
                           </div>
                           <div class="skill-row flex items-center h-6" data-skill="deception" data-attr="charisma">
                              <label for="skill-deception-prof" class="w-28 text-sm">Deception</label><span class="w-10 text-center text-xs text-gray-500">(CHA)</span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-deception-prof" class="skill-prof h-4 w-4" title="Check this box if the NPC has proficiency in Deception."></span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-deception-exp" class="skill-exp h-4 w-4" title="Check this box if the NPC has expertise in Deception."></span>
                              <input type="number" id="skill-deception-adjust" class="info-input h-5 w-16 text-center skill-adjust" min="-5" max="5" value="0" title="Any other adjustments to the bonus for Deception.">
                              <span id="skill-deception-total" class="w-12 text-center font-bold text-gray-800 skill-total"></span>
                           </div>
                           <div class="skill-row flex items-center h-6" data-skill="history" data-attr="intelligence">
                              <label for="skill-history-prof" class="w-28 text-sm">History</label><span class="w-10 text-center text-xs text-gray-500">(INT)</span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-history-prof" class="skill-prof h-4 w-4" title="Check this box if the NPC has proficiency in History."></span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-history-exp" class="skill-exp h-4 w-4" title="Check this box if the NPC has expertise in History."></span>
                              <input type="number" id="skill-history-adjust" class="info-input h-5 w-16 text-center skill-adjust" min="-5" max="5" value="0" title="Any other adjustments to the bonus for History.">
                              <span id="skill-history-total" class="w-12 text-center font-bold text-gray-800 skill-total"></span>
                           </div>
                           <div class="skill-row flex items-center h-6" data-skill="insight" data-attr="wisdom">
                              <label for="skill-insight-prof" class="w-28 text-sm">Insight</label><span class="w-10 text-center text-xs text-gray-500">(WIS)</span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-insight-prof" class="skill-prof h-4 w-4" title="Check this box if the NPC has proficiency in Insight."></span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-insight-exp" class="skill-exp h-4 w-4" title="Check this box if the NPC has expertise in Insight."></span>
                              <input type="number" id="skill-insight-adjust" class="info-input h-5 w-16 text-center skill-adjust" min="-5" max="5" value="0" title="Any other adjustments to the bonus for Insight.">
                              <span id="skill-insight-total" class="w-12 text-center font-bold text-gray-800 skill-total"></span>
                           </div>
                           <div class="skill-row flex items-center h-6" data-skill="intimidation" data-attr="charisma">
                              <label for="skill-intimidation-prof" class="w-28 text-sm">Intimidation</label><span class="w-10 text-center text-xs text-gray-500">(CHA)</span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-intimidation-prof" class="skill-prof h-4 w-4" title="Check this box if the NPC has proficiency in Intimidation."></span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-intimidation-exp" class="skill-exp h-4 w-4" title="Check this box if the NPC has expertise in Intimidation."></span>
                              <input type="number" id="skill-intimidation-adjust" class="info-input h-5 w-16 text-center skill-adjust" min="-5" max="5" value="0" title="Any other adjustments to the bonus for Intimidation.">
                              <span id="skill-intimidation-total" class="w-12 text-center font-bold text-gray-800 skill-total"></span>
                           </div>
                           <div class="skill-row flex items-center h-6" data-skill="investigation" data-attr="intelligence">
                              <label for="skill-investigation-prof" class="w-28 text-sm">Investigation</label><span class="w-10 text-center text-xs text-gray-500">(INT)</span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-investigation-prof" class="skill-prof h-4 w-4" title="Check this box if the NPC has proficiency in Investigation."></span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-investigation-exp" class="skill-exp h-4 w-4" title="Check this box if the NPC has expertise in Investigation."></span>
                              <input type="number" id="skill-investigation-adjust" class="info-input h-5 w-16 text-center skill-adjust" min="-5" max="5" value="0" title="Any other adjustments to the bonus for Investigation.">
                              <span id="skill-investigation-total" class="w-12 text-center font-bold text-gray-800 skill-total"></span>
                           </div>
                        </div>
                        <div class="space-y-1">
                           <div class="flex items-center font-semibold text-xs text-gray-500 mb-1">
                              <span class="w-28 text-left">Skill</span>
                              <span class="w-10 text-center">Attr</span>
                              <span class="w-8 text-center">Prof</span>
                              <span class="w-8 text-center">Exp</span>
                              <span class="w-16 text-center">Adjust</span>
                              <span class="w-12 text-center">Total</span>
                           </div>
                           <div class="skill-row flex items-center h-6" data-skill="medicine" data-attr="wisdom">
                              <label for="skill-medicine-prof" class="w-28 text-sm">Medicine</label><span class="w-10 text-center text-xs text-gray-500">(WIS)</span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-medicine-prof" class="skill-prof h-4 w-4" title="Check this box if the NPC has proficiency in Medicine."></span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-medicine-exp" class="skill-exp h-4 w-4" title="Check this box if the NPC has expertise in Medicine."></span>
                              <input type="number" id="skill-medicine-adjust" class="info-input h-5 w-16 text-center skill-adjust" min="-5" max="5" value="0" title="Any other adjustments to the bonus for Medicine.">
                              <span id="skill-medicine-total" class="w-12 text-center font-bold text-gray-800 skill-total"></span>
                           </div>
                           <div class="skill-row flex items-center h-6" data-skill="nature" data-attr="intelligence">
                              <label for="skill-nature-prof" class="w-28 text-sm">Nature</label><span class="w-10 text-center text-xs text-gray-500">(INT)</span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-nature-prof" class="skill-prof h-4 w-4" title="Check this box if the NPC has proficiency in Nature."></span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-nature-exp" class="skill-exp h-4 w-4" title="Check this box if the NPC has expertise in Nature."></span>
                              <input type="number" id="skill-nature-adjust" class="info-input h-5 w-16 text-center skill-adjust" min="-5" max="5" value="0" title="Any other adjustments to the bonus for Nature.">
                              <span id="skill-nature-total" class="w-12 text-center font-bold text-gray-800 skill-total"></span>
                           </div>
                           <div class="skill-row flex items-center h-6" data-skill="perception" data-attr="wisdom">
                              <label for="skill-perception-prof" class="w-28 text-sm">Perception</label><span class="w-10 text-center text-xs text-gray-500">(WIS)</span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-perception-prof" class="skill-prof h-4 w-4" title="Check this box if the NPC has proficiency in Perception."></span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-perception-exp" class="skill-exp h-4 w-4" title="Check this box if the NPC has expertise in Perception."></span>
                              <input type="number" id="skill-perception-adjust" class="info-input h-5 w-16 text-center skill-adjust" min="-5" max="5" value="0" title="Any other adjustments to the bonus for Perception.">
                              <span id="skill-perception-total" class="w-12 text-center font-bold text-gray-800 skill-total"></span>
                           </div>
                           <div class="skill-row flex items-center h-6" data-skill="performance" data-attr="charisma">
                              <label for="skill-performance-prof" class="w-28 text-sm">Performance</label><span class="w-10 text-center text-xs text-gray-500">(CHA)</span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-performance-prof" class="skill-prof h-4 w-4" title="Check this box if the NPC has proficiency in Performance."></span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-performance-exp" class="skill-exp h-4 w-4" title="Check this box if the NPC has expertise in Performance."></span>
                              <input type="number" id="skill-performance-adjust" class="info-input h-5 w-16 text-center skill-adjust" min="-5" max="5" value="0" title="Any other adjustments to the bonus for Performance.">
                              <span id="skill-performance-total" class="w-12 text-center font-bold text-gray-800 skill-total"></span>
                           </div>
                           <div class="skill-row flex items-center h-6" data-skill="persuasion" data-attr="charisma">
                              <label for="skill-persuasion-prof" class="w-28 text-sm">Persuasion</label><span class="w-10 text-center text-xs text-gray-500">(CHA)</span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-persuasion-prof" class="skill-prof h-4 w-4" title="Check this box if the NPC has proficiency in Persuasion."></span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-persuasion-exp" class="skill-exp h-4 w-4" title="Check this box if the NPC has expertise in Persuasion."></span>
                              <input type="number" id="skill-persuasion-adjust" class="info-input h-5 w-16 text-center skill-adjust" min="-5" max="5" value="0" title="Any other adjustments to the bonus for Persuasion.">
                              <span id="skill-persuasion-total" class="w-12 text-center font-bold text-gray-800 skill-total"></span>
                           </div>
                           <div class="skill-row flex items-center h-6" data-skill="religion" data-attr="intelligence">
                              <label for="skill-religion-prof" class="w-28 text-sm">Religion</label><span class="w-10 text-center text-xs text-gray-500">(INT)</span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-religion-prof" class="skill-prof h-4 w-4" title="Check this box if the NPC has proficiency in Religion."></span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-religion-exp" class="skill-exp h-4 w-4" title="Check this box if the NPC has expertise in Religion."></span>
                              <input type="number" id="skill-religion-adjust" class="info-input h-5 w-16 text-center skill-adjust" min="-5" max="5" value="0" title="Any other adjustments to the bonus for Religion.">
                              <span id="skill-religion-total" class="w-12 text-center font-bold text-gray-800 skill-total"></span>
                           </div>
                           <div class="skill-row flex items-center h-6" data-skill="sleight_of_hand" data-attr="dexterity">
                              <label for="skill-sleight_of_hand-prof" class="w-28 text-sm">Sleight of Hand</label><span class="w-10 text-center text-xs text-gray-500">(DEX)</span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-sleight_of_hand-prof" class="skill-prof h-4 w-4" title="Check this box if the NPC has proficiency in Sleight of Hand."></span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-sleight_of_hand-exp" class="skill-exp h-4 w-4" title="Check this box if the NPC has expertise in Sleight of Hand."></span>
                              <input type="number" id="skill-sleight_of_hand-adjust" class="info-input h-5 w-16 text-center skill-adjust" min="-5" max="5" value="0" title="Any other adjustments to the bonus for Sleight of Hand.">
                              <span id="skill-sleight_of_hand-total" class="w-12 text-center font-bold text-gray-800 skill-total"></span>
                           </div>
                           <div class="skill-row flex items-center h-6" data-skill="stealth" data-attr="dexterity">
                              <label for="skill-stealth-prof" class="w-28 text-sm">Stealth</label><span class="w-10 text-center text-xs text-gray-500">(DEX)</span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-stealth-prof" class="skill-prof h-4 w-4" title="Check this box if the NPC has proficiency in Stealth."></span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-stealth-exp" class="skill-exp h-4 w-4" title="Check this box if the NPC has expertise in Stealth."></span>
                              <input type="number" id="skill-stealth-adjust" class="info-input h-5 w-16 text-center skill-adjust" min="-5" max="5" value="0" title="Any other adjustments to the bonus for Stealth.">
                              <span id="skill-stealth-total" class="w-12 text-center font-bold text-gray-800 skill-total"></span>
                           </div>
                           <div class="skill-row flex items-center h-6" data-skill="survival" data-attr="wisdom">
                              <label for="skill-survival-prof" class="w-28 text-sm">Survival</label><span class="w-10 text-center text-xs text-gray-500">(WIS)</span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-survival-prof" class="skill-prof h-4 w-4" title="Check this box if the NPC has proficiency in Survival."></span>
                              <span class="w-8 flex justify-center"><input type="checkbox" id="skill-survival-exp" class="skill-exp h-4 w-4" title="Check this box if the NPC has expertise in Survival."></span>
                              <input type="number" id="skill-survival-adjust" class="info-input h-5 w-16 text-center skill-adjust" min="-5" max="5" value="0" title="Any other adjustments to the bonus for Survival.">
                              <span id="skill-survival-total" class="w-12 text-center font-bold text-gray-800 skill-total"></span>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>

               <div id="lang-card" class="bg-white rounded-xl custom-shadow overflow-hidden bordered-container card-font-style">
                  <div class="card-header bg-[#F1FBEA] px-3 py-1 border-b border-black/20 flex justify-between items-center">
                     <h2 class="font-bold text-slate-700 cursor-pointer select-none">Languages</h2>
                     <button id="manage-languages-btn" title="Manage Languages">
                        <svg class="h-5 w-5 text-gray-600 hover:text-black" fill="currentColor"><use href="#icon-manage"></use></svg>
                     </button>
                  </div>
                  <div class="card-body">
                     <div class="p-4 space-y-4">
                        <div class="flex justify-around space-x-2">
                           <div>
                              <label class="label-text mb-1 text-center">Standard</label>
                              <select multiple id="language-list-standard" title="Select languages known by the NPC. Hold Ctrl/Cmd to select multiple." class="language-listbox" size="12" style="width: 150px;"></select>
                           </div>
                           <div>
                              <label class="label-text mb-1 text-center">Exotic</label>
                              <select multiple id="language-list-exotic" title="Select languages known by the NPC. Hold Ctrl/Cmd to select multiple." class="language-listbox" size="12" style="width: 150px;"></select>
                           </div>
                           <div>
                              <label class="label-text mb-1 text-center">Monstrous I</label>
                              <select multiple id="language-list-monstrous1" title="Select languages known by the NPC. Hold Ctrl/Cmd to select multiple." class="language-listbox" size="12" style="width: 150px;"></select>
                           </div>
                           <div>
                              <label class="label-text mb-1 text-center">Monstrous II</label>
                              <select multiple id="language-list-monstrous2" title="Select languages known by the NPC. Hold Ctrl/Cmd to select multiple." class="language-listbox" size="12" style="width: 150px;"></select>
                           </div>
                           <div>
                              <label class="label-text mb-1 text-center">User</label>
                              <select multiple id="language-list-user" title="Select languages known by the NPC. Hold Ctrl/Cmd to select multiple." class="language-listbox" size="12" style="width: 150px;"></select>
                           </div>
                        </div>
                        <div class="border-t pt-3 flex justify-between items-center">
                           <div class="flex items-center space-x-4">
                              <div class="flex items-center">
                                 <input type="checkbox" id="npc-has-telepathy" title="Check if the NPC possesses telepathy." class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                 <label for="npc-has-telepathy" class="ml-2 label-text">Has Telepathy</label>
                              </div>
                              <div class="flex items-center">
                                 <label for="npc-telepathy-range" class="label-text mr-2">Range (ft.)</label>
                                 <input type="number" id="npc-telepathy-range" title="Enter the range of the NPC's telepathy in feet. Leave as 0 or blank for default (usually 60 ft.)." class="info-input h-6 w-16 text-center" min="0" step="10">
                              </div>
                           </div>
                           <div class="flex items-center">
                              <label for="npc-special-language-option" class="label-text mr-2">Special Language Options</label>
                              <select id="npc-special-language-option" title="Select any special language conditions, like understanding but not speaking." class="info-select h-6">
                                 <option value="0">No special conditions</option>
                                 <option value="1">Speaks no languages</option>
                                 <option value="2">Speaks all languages</option>
                                 <option value="3">Speaks languages it knew in life</option>
                                 <option value="4">Can't speak; knows selected languages</option>
                                 <option value="5">Can't speak; knows creator's languages</option>
                                 <option value="6">Can't speak; knows languages known in life</option>
                              </select>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>

               <div id="traits-card" class="bg-white rounded-xl custom-shadow overflow-hidden bordered-container card-font-style">
                  <div class="card-header bg-[#F1FBEA] px-3 py-1 border-b border-black/20 flex justify-between items-center">
                     <h2 class="font-bold text-slate-700 cursor-pointer select-none">Traits</h2>
                     <button id="manage-traits-btn" title="Manage Traits">
                        <svg class="h-5 w-5 text-gray-600 hover:text-black" fill="currentColor"><use href="#icon-manage"></use></svg>
                     </button>
                  </div>
                  <div class="card-body">
                     <div class="p-4">
                        <div id="npc-trait-list" class="space-y-2">
                           </div>
                        <div class="flex items-center justify-end mt-2">
                           <input type="checkbox" id="sort-traits-alpha" title="Check to automatically sort traits alphabetically in the list below and in the stat block preview. Uncheck for manual drag-and-drop ordering." class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                           <label for="sort-traits-alpha" class="ml-2 label-text text-xs">Sort traits alphabetically</label>
                        </div>
                        <hr class="my-4 border-gray-300">
                        <div class="space-y-2">
                           <div>
                              <label for="new-trait-name" class="label-text">Trait Name</label>
                              <input id="new-trait-name" list="saved-trait-list" title="Enter the name for a new trait, or start typing to select/edit an existing saved trait." class="info-input w-full" autocomplete="off">
                              <datalist id="saved-trait-list"></datalist>
                           </div>
                           <div>
                              <label for="new-trait-description" class="label-text">Trait Description</label>
                              <textarea id="new-trait-description" title="Enter the description for the trait. Use {tokens} like {name} or {he} for automatic replacement." class="info-input w-full h-24" rows="3"></textarea>
                           </div>
                           <div class="text-right">
                              <button id="add-trait-btn" title="Add the trait name and description above to this NPC's trait list, or update if the name already exists." class="btn-primary">Add Trait</button>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>

               <div id="spells-card" class="bg-white rounded-xl custom-shadow overflow-hidden bordered-container card-font-style">
                     <div class="card-header bg-[#F1FBEA] px-3 py-1 border-b border-black/20 flex justify-between items-center cursor-pointer select-none">
                         <h2 class="font-bold text-slate-700">Spellcasting & Psionics</h2>
                     </div>
                     <div class="card-body">
                         <div class="p-4 space-y-4">
                              <div class="flex justify-between items-center pb-0">
                                  <h3 id="innate-spellcasting-header" class="text-lg font-bold text-gray-400 mb-0">Innate Spellcasting</h3>
                                  <div class="flex items-center">
                                       <label for="npc-has-innate-spellcasting" class="label-text text-sm mr-2 whitespace-nowrap">Include Innate Spellcasting section</label>
                                       <input type="checkbox" id="npc-has-innate-spellcasting" title="Check to enable and show the Innate Spellcasting section and options." class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                  </div>
                              </div>
                              <hr id="innate-divider" class="border-gray-300 border-t-2 hidden my-0">
                              <div id="innate-spellcasting-fields" class="pt-2 pl-4 space-y-4 transition-opacity duration-300 opacity-0 hidden">
                                  <div class="flex justify-end items-center pt-0">
                                       <label for="npc-innate-is-psionics" class="label-text text-sm mr-2">Use as Psionics</label>
                                       <input type="checkbox" id="npc-innate-is-psionics" title="Check to display the section header as 'Innate Spellcasting (Psionics)' instead of just 'Innate Spellcasting'." class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                  </div>
                                  <div class="relative border border-gray-300 rounded-md p-4 pt-5">
                                       <h4 class="absolute -top-2.5 left-4 bg-white px-1 text-sm font-medium text-gray-600">Caster Information</h4>
                                       <div class="flex items-center space-x-4">
                                           <div class="flex items-center space-x-2 flex-shrink-0">
                                                <label for="npc-innate-ability" class="label-text text-xs whitespace-nowrap">Ability</label>
                                                <select id="npc-innate-ability" class="info-select h-6 text-xs w-28" title="Select the ability score used for innate spellcasting DC calculation.">
                                                    <option value="strength">Strength</option>
                                                    <option value="dexterity">Dexterity</option>
                                                    <option value="constitution">Constitution</option>
                                                    <option value="intelligence">Intelligence</option>
                                                    <option value="wisdom">Wisdom</option>
                                                    <option value="charisma" selected>Charisma</option>
                                                </select>
                                           </div>
                                           <div class="flex items-center space-x-2 flex-shrink-0">
                                                <label for="npc-innate-dc" class="label-text text-xs whitespace-nowrap">Save DC</label>
                                                <input type="number" id="npc-innate-dc" class="info-input h-6 text-xs w-12 text-center" min="0" max="30" title="Innate spell save DC. Automatically calculated based on ability and proficiency, but can be manually overridden."> </div>
                                           <div class="flex items-center space-x-2 flex-grow">
                                                <label for="npc-innate-components" class="label-text text-xs whitespace-nowrap">Components</label>
                                                <input type="text" id="npc-innate-components" title="Describe any component requirements (or lack thereof) for innate spells (e.g., 'requiring no material components')." class="info-input h-6 text-xs w-full" value="requiring no material components">
                                           </div>
                                       </div>
                                  </div>
                                  <div class="relative border border-gray-300 rounded-md p-4 pt-5">
                                       <h4 class="absolute -top-2.5 left-4 bg-white px-1 text-sm font-medium text-gray-600">Spell Selection</h4>
                                       <div class="grid grid-cols-[100px_auto] gap-x-4 mb-1">
                                           <div class="label-text text-xs text-center font-semibold">No. of Casts</div>
                                           <div class="label-text text-xs font-semibold">Spells</div>
                                       </div>
                                       <div class="space-y-1">
                                           <div class="grid grid-cols-[100px_auto] gap-x-4 items-center">
                                                <input type="text" id="npc-innate-freq-0" class="info-input h-6 text-xs text-center" value="At will" title="Frequency of casting for this group of spells (e.g., 'At will', '1/day each').">
                                                <input type="text" id="npc-innate-list-0" title="Comma-separated list of spells for this frequency. Spell names will be italicized automatically." class="info-input h-6 text-xs" placeholder="e.g., mage hand, prestidigitation">
                                           </div>
                                           <div class="grid grid-cols-[100px_auto] gap-x-4 items-center">
                                                <input type="text" id="npc-innate-freq-1" class="info-input h-6 text-xs text-center" value="3/day each" title="Frequency of casting for this group of spells (e.g., 'At will', '1/day each').">
                                                <input type="text" id="npc-innate-list-1" title="Comma-separated list of spells for this frequency. Spell names will be italicized automatically." class="info-input h-6 text-xs" placeholder="e.g., detect magic, disguise self">
                                           </div>
                                           <div class="grid grid-cols-[100px_auto] gap-x-4 items-center">
                                                <input type="text" id="npc-innate-freq-2" class="info-input h-6 text-xs text-center" value="1/day each" title="Frequency of casting for this group of spells (e.g., 'At will', '1/day each').">
                                                <input type="text" id="npc-innate-list-2" title="Comma-separated list of spells for this frequency. Spell names will be italicized automatically." class="info-input h-6 text-xs" placeholder="e.g., shield, misty step">
                                           </div>
                                           <div class="grid grid-cols-[100px_auto] gap-x-4 items-center">
                                                <input type="text" id="npc-innate-freq-3" class="info-input h-6 text-xs text-center" value="" title="Frequency of casting for this group of spells (e.g., 'At will', '1/day each').">
                                                <input type="text" id="npc-innate-list-3" title="Comma-separated list of spells for this frequency. Spell names will be italicized automatically." class="info-input h-6 text-xs" placeholder="Additional spells...">
                                           </div>
                                       </div>
                                  </div>
                              </div>

                              <div class="flex justify-between items-center pt-4 pb-0">
                                  <h3 id="spellcasting-header" class="text-lg font-bold text-gray-400 mb-0">Spellcasting</h3>
                                  <div class="flex items-center">
                                       <label for="npc-has-spellcasting" class="label-text text-sm mr-2 whitespace-nowrap">Include Spellcasting section</label>
                                       <input type="checkbox" id="npc-has-spellcasting" title="Check to enable and show the standard Spellcasting section and options (configured below as either a Trait or an Action)." class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                  </div>
                              </div>
                              <hr id="spellcasting-divider" class="border-gray-300 border-t-2 hidden my-0">
                              <div id="spellcasting-fields" class="pt-2 pl-4 space-y-1 transition-opacity duration-300 opacity-0 hidden">
                                  <div class="flex justify-end space-x-4">
                                       <div class="radio-container">
                                           <label for="npc-spellcasting-to-traits" class="label-text text-sm">Use in Traits</label>
                                           <input type="radio" id="npc-spellcasting-to-traits" name="spellcasting-placement" value="traits" checked title="Place the Spellcasting block in the Traits section." class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                       </div>
                                       <div class="radio-container">
                                           <label for="npc-spellcasting-to-actions" class="label-text text-sm">Use in Actions</label>
                                           <input type="radio" id="npc-spellcasting-to-actions" name="spellcasting-placement" value="actions" title="Place the Spellcasting block in the Actions section." class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                       </div>
                                  </div>

                                  <div id="trait-spellcasting-fields" class="pt-2 space-y-4 transition-opacity duration-300 opacity-0 hidden">
                                       <div class="relative border border-gray-300 rounded-md p-4 pt-5">
                                           <h4 class="absolute -top-2.5 left-4 bg-white px-1 text-sm font-medium text-gray-600">Caster Information</h4>
                                           <div class="space-y-2 pl-1">
                                                <div class="grid grid-cols-[auto_auto_auto_auto_auto_1fr] gap-x-4 items-center">
                                                    <div class="flex items-center space-x-1">
                                                         <label for="npc-trait-casting-level" class="label-text text-xs whitespace-nowrap">Caster Level</label>
                                                         <select id="npc-trait-casting-level" title="Select the NPC's caster level (e.g., '3rd' for a 3rd-level spellcaster). Affects spell slot defaults." class="info-select h-6 text-xs" style="width: 65px;"></select>
                                                    </div>
                                                    <div class="flex items-center space-x-1">
                                                         <label for="npc-trait-casting-ability" class="label-text text-xs whitespace-nowrap">Spellcasting Ability</label>
                                                         <select id="npc-trait-casting-ability" title="Select the ability score used for this spellcasting block's Save DC and Attack Bonus calculations." class="info-select h-6 text-xs w-28">
                                                            <option value="strength">Strength</option>
                                                            <option value="dexterity">Dexterity</option>
                                                            <option value="constitution">Constitution</option>
                                                            <option value="intelligence" selected>Intelligence</option>
                                                            <option value="wisdom">Wisdom</option>
                                                            <option value="charisma">Charisma</option>
                                                         </select>
                                                    </div>
                                                    <div class="flex items-center space-x-1">
                                                         <label for="npc-trait-casting-dc" class="label-text text-xs whitespace-nowrap">Spell Save DC</label>
                                                         <input type="number" id="npc-trait-casting-dc" class="info-input h-6 text-xs w-12 text-center" min="0" max="30" title="Trait spell save DC. Auto-calculated based on ability and proficiency, can be overridden.">
                                                    </div>
                                                    <div class="flex items-center space-x-1">
                                                         <label for="npc-trait-casting-bonus" class="label-text text-xs whitespace-nowrap">Spell Hit Bonus</label>
                                                         <input type="number" id="npc-trait-casting-bonus" class="info-input h-6 text-xs w-12 text-center" min="-5" max="20" title="Trait spell attack bonus. Auto-calculated based on ability and proficiency, can be overridden.">
                                                    </div>
                                                    <div class="flex items-center space-x-1">
                                                         <label for="npc-trait-casting-class" class="label-text text-xs whitespace-nowrap">Spell Class</label>
                                                         <select id="npc-trait-casting-class" title="Select the spellcasting class (optional). Used for flavor text in the stat block." class="info-select h-6 text-xs w-24">
                                                            <option value="">None</option>
                                                            <option>Bard</option>
                                                            <option>Cleric</option>
                                                            <option>Druid</option>
                                                            <option>Paladin</option>
                                                            <option>Ranger</option>
                                                            <option>Sorcerer</option>
                                                            <option>Warlock</option>
                                                            <option>Wizard</option>
                                                         </select>
                                                    </div>
                                                    <div></div> </div>
                                                <div class="flex items-center space-x-2">
                                                    <label for="npc-trait-casting-flavor" class="label-text text-xs whitespace-nowrap">Flavor Text</label>
                                                    <input type="text" id="npc-trait-casting-flavor" title="Optional introductory text for the spellcasting trait (e.g., 'The acolyte is a 1st-level spellcaster.'). Overrides default flavor text." class="info-input h-6 text-xs w-full" placeholder="">
                                                </div>
                                           </div>
                                       </div>
                                       <div class="relative border border-gray-300 rounded-md p-4 pt-5">
                                           <h4 class="absolute -top-2.5 left-4 bg-white px-1 text-sm font-medium text-gray-600">Spell Selection</h4>
                                           <div class="grid grid-cols-[60px_75px_auto] gap-x-3 mb-1 items-center"> <div class="label-text text-xs font-semibold">Spell Level</div>
                                                <div class="label-text text-xs font-semibold text-center">No. of Casts</div>
                                                <div class="label-text text-xs font-semibold">Spells</div>
                                           </div>
                                           <div class="space-y-1">
                                                <div class="grid grid-cols-[60px_75px_auto] gap-x-3 items-center">
                                                    <span class="label-text text-xs">Cantrips</span>
                                                    <span class="text-xs text-center text-gray-500">At will</span> <input type="text" id="npc-trait-casting-list-0" title="Comma-separated list of cantrips known. Spell names will be italicized automatically." class="info-input h-6 text-xs" placeholder="e.g., fire bolt, light">
                                                </div>
                                                <script>
                                                   // Generate rows 1-9 dynamically
                                                   for (let i = 1; i <= 9; i++) {
                                                      const levelSuffix = i === 1 ? 'st' : i === 2 ? 'nd' : i === 3 ? 'rd' : 'th';
                                                      document.write(`
                                                          <div class="grid grid-cols-[60px_75px_auto] gap-x-3 items-center">
                                                               <span class="label-text text-xs">${i}${levelSuffix} level</span>
                                                               <select id="npc-trait-casting-slots-${i}" title="Select the number of ${i}${levelSuffix}-level spell slots available." class="info-select h-6 text-xs text-center">
                                                                   <option value="0">—</option>
                                                                   ${[...Array(10).keys()].map(n => `<option value="${n + 1}">${n + 1} slot${n > 0 ? 's' : ''}</option>`).join('')}
                                                               </select>
                                                               <input type="text" id="npc-trait-casting-list-${i}" title="Comma-separated list of prepared/known ${i}${levelSuffix}-level spells. Add '*' after a spell name to mark it (e.g., mage armor*). Spell names will be italicized." class="info-input h-6 text-xs" placeholder="e.g., magic missile, shield">
                                                          </div>
                                                      `);
                                                   }
                                                </script>
</div>
                                           <div class="flex items-center space-x-2 mt-3 pt-2 border-t border-gray-200">
                                                <label for="npc-trait-casting-marked" class="label-text text-xs whitespace-nowrap">Marked Spells</label>
                                                <input type="text" id="npc-trait-casting-marked" title="Optional text describing spells marked with an asterisk (*), often indicating pre-cast buffs (e.g., '* The archmage casts these spells on itself before combat.')." class="info-input h-6 text-xs w-full" placeholder="e.g. *The archmage casts these spells on itself before combat.">
                                           </div>
                                       </div>
                                       </div>
                                  <div id="action-spellcasting-fields" class="pt-2 space-y-4 transition-opacity duration-300 opacity-0 hidden">
                                       <div class="relative border border-gray-300 rounded-md p-4 pt-5">
                                           <h4 class="absolute -top-2.5 left-4 bg-white px-1 text-sm font-medium text-gray-600">Caster Information</h4>
                                           <div class="flex items-center space-x-4">
                                                <div class="flex items-center space-x-2 flex-shrink-0">
                                                    <label for="npc-action-casting-ability" class="label-text text-xs whitespace-nowrap">Ability</label>
                                                    <select id="npc-action-casting-ability" title="Select the ability score used for this action-based spellcasting block's Save DC calculation." class="info-select h-6 text-xs w-28">
                                                         <option value="strength">Strength</option>
                                                         <option value="dexterity">Dexterity</option>
                                                         <option value="constitution">Constitution</option>
                                                         <option value="intelligence" selected>Intelligence</option>
                                                         <option value="wisdom">Wisdom</option>
                                                         <option value="charisma">Charisma</option>
                                                    </select>
                                                </div>
                                                <div class="flex items-center space-x-2 flex-shrink-0">
                                                    <label for="npc-action-casting-dc" class="label-text text-xs whitespace-nowrap">Save DC</label>
                                                    <input type="number" id="npc-action-casting-dc" title="Action spell save DC. Automatically calculated based on ability and proficiency, but can be manually overridden." class="info-input h-6 text-xs w-12 text-center" min="0" max="30">
                                                </div>
                                                <div class="flex items-center space-x-2 flex-grow">
                                                    <label for="npc-action-casting-components" class="label-text text-xs whitespace-nowrap">Components</label>
                                                    <input type="text" id="npc-action-casting-components" title="Enter component requirements often listed with action-based spellcasting (e.g., 'V, S'). Leave blank if none or detailed elsewhere." class="info-input h-6 text-xs w-full" placeholder="e.g., (V, S, M)">
                                                </div>
                                           </div>
                                       </div>
                                       <div class="relative border border-gray-300 rounded-md p-4 pt-5">
                                           <h4 class="absolute -top-2.5 left-4 bg-white px-1 text-sm font-medium text-gray-600">Spell Selection (Action)</h4>
                                           <div class="grid grid-cols-[100px_auto] gap-x-4 mb-1">
                                                <div class="label-text text-xs text-center font-semibold">No. of Casts</div>
                                                <div class="label-text text-xs font-semibold">Spells</div>
                                           </div>
                                           <div class="space-y-1">
                                                <div class="grid grid-cols-[100px_auto] gap-x-4 items-center">
                                                    <input type="text" id="npc-action-casting-freq-0" title="Frequency of casting for this group of spells (e.g., 'At will', '1/day each')." class="info-input h-6 text-xs text-center" value="At will">
                                                    <input type="text" id="npc-action-casting-list-0" title="Comma-separated list of spells for this frequency. Spell names will be italicized automatically." class="info-input h-6 text-xs" placeholder="e.g., mage hand, prestidigitation">
                                                </div>
                                                <div class="grid grid-cols-[100px_auto] gap-x-4 items-center">
                                                    <input type="text" id="npc-action-casting-freq-1" title="Frequency of casting for this group of spells (e.g., 'At will', '1/day each')." class="info-input h-6 text-xs text-center" value="3/day each">
                                                    <input type="text" id="npc-action-casting-list-1" title="Comma-separated list of spells for this frequency. Spell names will be italicized automatically." class="info-input h-6 text-xs" placeholder="e.g., detect magic, disguise self">
                                                </div>
                                                <div class="grid grid-cols-[100px_auto] gap-x-4 items-center">
                                                    <input type="text" id="npc-action-casting-freq-2" title="Frequency of casting for this group of spells (e.g., 'At will', '1/day each')." class="info-input h-6 text-xs text-center" value="1/day each">
                                                    <input type="text" id="npc-action-casting-list-2" title="Comma-separated list of spells for this frequency. Spell names will be italicized automatically." class="info-input h-6 text-xs" placeholder="e.g., shield, misty step">
                                                </div>
                                                <div class="grid grid-cols-[100px_auto] gap-x-4 items-center">
                                                    <input type="text" id="npc-action-casting-freq-3" title="Frequency of casting for this group of spells (e.g., 'At will', '1/day each')." class="info-input h-6 text-xs text-center" value="">
                                                    <input type="text" id="npc-action-casting-list-3" title="Comma-separated list of spells for this frequency. Spell names will be italicized automatically." class="info-input h-6 text-xs" placeholder="Additional spells...">
                                                </div>
                                           </div>
                                       </div>
                                  </div>
                               </div>
                         </div>
                     </div>
				</div>

               <div id="actions-card" class="bg-white rounded-xl custom-shadow overflow-hidden bordered-container card-font-style">
                  <div class="card-header bg-[#F1FBEA] px-3 py-1 border-b border-black/20 cursor-pointer select-none">
                     <h2 class="font-bold text-slate-700 relative" style="top: 0px;">Actions</h2>
                  </div>
                  <div class="card-body">
                     <div class="p-4">
                        <div class="bg-white p-4 rounded-lg border border-gray-300 shadow-sm">
                           <h2 class="text-lg font-bold mb-2">Create or Edit an Action</h2>
                           <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                              <div class="md:col-span-1">
                                 <label for="common-name" class="label-text">Name</label>
                                 <input type="text" id="common-name" class="info-input mt-1 block w-full" placeholder="e.g., Multiattack" title="The name of the action, such as 'Multiattack' or 'Claw'.">
                              </div>
                              <div class="md:col-span-2">
                                  <label for="common-desc" class="label-text">Description</label>
                                 <textarea id="common-desc" rows="3" class="info-input mt-1 block w-full" placeholder="Describe the action..." title="Double-click for the Attack Helper."></textarea>
                              </div>
                           </div>
                           <div class="mt-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2">
                              <button data-action-type="actions" class="btn-primary" title="Add the current entry to the Actions list.">Action</button>
                              <button data-action-type="bonus-actions" class="btn-primary" title="Add the current entry to the Bonus Actions list.">Bonus Action</button>
                              <button data-action-type="reactions" class="btn-primary" title="Add the current entry to the Reactions list.">Reaction</button>
                              <button data-action-type="legendary-actions" class="btn-primary" title="Add the current entry to the Legendary Actions list.">Legendary</button>
                              <button data-action-type="lair-actions" class="btn-primary" title="Add the current entry to the Lair Actions list.">Lair</button>
                           </div>
                           <button id="clear-edit-btn" title="Clear the action name and description fields and cancel the current edit." class="btn-secondary btn-xs hidden w-full mt-2">Cancel Edit</button>
                        </div>

                        <div class="border-t border-gray-300 pt-4 mt-4"><h2 class="text-lg font-bold">Actions</h2><ul id="actions-container" class="space-y-2 mt-2 list-none p-0"></ul></div>
                        <div class="border-t border-gray-300 pt-4 mt-4"><h2 class="text-lg font-bold">Bonus Actions</h2><ul id="bonus-actions-container" class="space-y-2 mt-2 list-none p-0"></ul></div>
                        <div class="border-t border-gray-300 pt-4 mt-4"><h2 class="text-lg font-bold">Reactions</h2><ul id="reactions-container" class="space-y-2 mt-2 list-none p-0"></ul></div>
                        <div class="border-t border-gray-300 pt-4 mt-4"><h2 class="text-lg font-bold">Legendary Actions</h2><p id="legendary-boilerplate" title="Double-click to edit the standard introductory text for Legendary Actions." class="text-sm text-gray-600 p-2 rounded-md hover:bg-gray-100 cursor-pointer"></p><ul id="legendary-actions-container" class="space-y-2 mt-2 list-none p-0"></ul></div>
                        <div class="border-t border-gray-300 pt-4 mt-4"><h2 class="text-lg font-bold">Lair Actions</h2><p id="lair-boilerplate" title="Double-click to edit the standard introductory text for Lair Actions." class="text-sm text-gray-600 p-2 rounded-md hover:bg-gray-100 cursor-pointer"></p><ul id="lair-actions-container" class="space-y-2 mt-2 list-none p-0"></ul></div>
                     </div>
                  </div>
               </div>
					
					<div id="desc-card" class="bg-white rounded-xl custom-shadow overflow-hidden bordered-container card-font-style">
               <div class="card-header bg-[#F1FBEA] px-3 py-1 border-b border-black/20 cursor-pointer select-none">
                  <h2 class="font-bold text-slate-700 relative" style="top: 0px;">Description</h2>
               </div>
               <div class="card-body">
                  <div class="p-2">
                     <input id="npc-description" type="hidden" name="content">
                     <trix-editor input="npc-description" class="trix-content"></trix-editor>
                     <div class="flex justify-end mt-2">
                        <button id="manage-clipboard-btn" class="btn-primary btn-xs" title="Open a clipboard manager to clean and paste text.">Manage Clipboard Text</button>
                     </div>
                  </div>
               </div>
            </div>
			</div>
				
            <aside class="w-[500px] flex-shrink-0 lg:sticky top-36">
               <div id="viewport" class="w-[500px] h-[800px] bg-cover bg-center rounded-xl custom-shadow overflow-auto bordered-container" style=" padding-top: 10px; background-image: url(&quot;graphics/viewport.jpg&quot;); background-repeat: repeat; background-position: top left; background-size: auto; overflow-y: scroll;">
                  </div>
               <div id="npc-options-container" class="hidden w-full mt-2 ml-5">
                  <div class="flex flex-col space-y-1">
                     <div class="flex items-center">
                        <input type="checkbox" id="npc-add-description" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                        <label for="npc-add-description" class="ml-2 label-text text-xs">Add description to the NPC</label>
                     </div>
                     <div class="flex items-center">
                        <input type="checkbox" id="npc-add-title" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                        <label for="npc-add-title" class="ml-2 label-text text-xs">Add a title</label>
                     </div>
                     <div class="flex items-center">
                        <input type="checkbox" id="npc-add-image-link" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                        <label for="npc-add-image-link" class="ml-2 label-text text-xs">Add an image link</label>
                     </div>
                     <div class="flex items-center">
                        <input type="checkbox" id="npc-use-drop-cap" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                        <label for="npc-use-drop-cap" class="ml-2 label-text text-xs">Use a drop cap in the description</label>
                     </div>
                  </div>
               </div>
            </aside>
         </main>
      </div>

      <div id="modal-overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">

         <div id="new-bestiary-modal" class="bg-white rounded-xl custom-shadow bordered-container card-font-style p-4 space-y-3 w-80 hidden modal-content">
            <div class="flex justify-between items-center mb-2">
               <h3 class="font-bold text-slate-700">Create New Bestiary</h3>
               <button title="Close" class="modal-close-btn text-gray-500 hover:text-black text-2xl leading-none">&times;</button>
            </div>
            <div class="space-y-2">
               <div>
                  <label for="new-bestiary-name" class="label-text">Bestiary Name</label>
                  <input type="text" id="new-bestiary-name" class="info-input w-full">
               </div>
            </div>
            <div class="text-right pt-2">
               <button id="create-bestiary-btn" title="Create a new bestiary with the specified name." class="btn-primary">Create</button>
            </div>
         </div>

         <div id="load-bestiary-modal" class="bg-white rounded-xl custom-shadow bordered-container card-font-style p-4 space-y-3 w-96 hidden modal-content">
            <div class="flex justify-between items-center mb-2">
               <h3 class="font-bold text-slate-700">Load Bestiary</h3>
               <button title="Close" class="modal-close-btn text-gray-500 hover:text-black text-2xl leading-none">&times;</button>
            </div>
            <div id="bestiary-list" class="space-y-2 max-h-80 overflow-y-auto">
               </div>
         </div>

         <div id="manage-groups-modal" class="bg-white rounded-xl custom-shadow bordered-container card-font-style p-4 space-y-3 w-96 hidden modal-content">
            <div class="flex justify-between items-center mb-2">
               <h3 class="font-bold text-slate-700">Manage Groups</h3>
               <button title="Close" class="modal-close-btn text-gray-500 hover:text-black text-2xl leading-none">&times;</button>
            </div>
            <div class="flex space-x-2">
               <input type="text" id="new-group-name" class="info-input w-full" placeholder="New group name...">
               <button id="add-group-btn" class="btn-primary">Add</button>
            </div>
            <div id="group-list" class="space-y-1 max-h-60 overflow-y-auto border-t pt-2 mt-2">
               </div>
         </div>

         <div id="manage-languages-modal" class="bg-white rounded-xl custom-shadow bordered-container card-font-style p-4 space-y-3 w-96 hidden modal-content">
            <div class="flex justify-between items-center mb-2">
               <h3 class="font-bold text-slate-700">Manage Languages</h3>
               <button title="Close" class="modal-close-btn text-gray-500 hover:text-black text-2xl leading-none">&times;</button>
            </div>
            <div class="flex space-x-2">
               <input type="text" id="new-language-name" class="info-input w-full" placeholder="New language name...">
               <button id="add-language-btn" class="btn-primary">Add</button>
            </div>
            <div id="language-list-div" class="space-y-1 max-h-60 overflow-y-auto border-t pt-2 mt-2">
               </div>
         </div>

         <div id="manage-traits-modal" class="bg-white rounded-xl custom-shadow bordered-container card-font-style p-4 space-y-3 w-[500px] hidden modal-content">
            <div class="flex justify-between items-center mb-2">
               <h3 class="font-bold text-slate-700">Manage Traits</h3>
               <button title="Close" class="modal-close-btn text-gray-500 hover:text-black text-2xl leading-none">&times;</button>
            </div>
            <div class="space-y-2">
               <input type="text" id="modal-trait-name" class="info-input w-full" placeholder="New trait name...">
               <textarea id="modal-trait-description" class="info-input w-full h-24" placeholder="Trait description..."></textarea>
               <div class="mt-2">
                  <div id="modal-token-buttons" class="flex items-center space-x-1">
                     <button class="text-xs bg-gray-200 hover:bg-gray-300 px-2 py-0.5 rounded" data-token="{name}">{name}</button>
                     <button class="text-xs bg-gray-200 hover:bg-gray-300 px-2 py-0.5 rounded" data-token="{he}">{he}</button>
                     <button class="text-xs bg-gray-200 hover:bg-gray-300 px-2 py-0.5 rounded" data-token="{him}">{him}</button>
                     <button class="text-xs bg-gray-200 hover:bg-gray-300 px-2 py-0.5 rounded" data-token="{his}">{his}</button>
                     <button class="text-xs bg-gray-200 hover:bg-gray-300 px-2 py-0.5 rounded" data-token="{himself}">{himself}</button>
                  </div>
                  <div class="mt-2 text-xs text-gray-600">
                     <div id="trait-reference-content" class="mt-1 p-2 border rounded-md bg-gray-50 text-[10px] leading-relaxed">
                        <b>Quick Reference:</b><br>
                        <b>Click</b> a button to insert its lowercase token (e.g., <code>{he}</code>).<br>
                        <b>Shift+Click</b> a button to insert its capitalized version (e.g., <code>{He}</code>).
                     </div>
                  </div>
               </div>
               <button id="add-managed-trait-btn" class="btn-primary float-right">Add</button>
            </div>
            <div id="managed-trait-list-div" class="space-y-1 max-h-60 overflow-y-auto border-t pt-10 mt-2">
               </div>
         </div>

			<div id="first-use-modal" class="modal-content bg-white rounded-xl custom-shadow bordered-container card-font-style p-6 w-full max-w-lg transform scale-95 hidden" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-4">
               <h3 class="text-lg font-bold text-slate-700">Important: How Your Data is Saved</h3>
               <button title="Close" class="modal-close-btn text-gray-500 hover:text-black text-2xl leading-none">&times;</button>
            </div>
            <div class="space-y-3 text-sm">
               <p>Welcome to NPC Engineer! Your bestiaries and NPCs are saved automatically using your web browser's internal storage (IndexedDB).</p>
               <p><strong>Please understand these limitations:</strong></p>
               <ul class="list-disc list-inside space-y-1 pl-2">
                  <li>Data is stored <strong>only within this specific browser</strong> on this machine. It cannot be accessed from other browsers (e.g., Chrome vs. Firefox) or other computers.</li>
                  <li>Aggressive browser cleaning settings or tools that clear "site data" or "cache" <strong>can permanently delete</strong> your saved bestiaries.</li>
                  <li>There is <strong>no automatic cloud backup</strong>.</li>
               </ul>
               <p class="font-semibold text-red-700">⚠️ It is strongly recommended that you regularly use the <svg class="inline h-4 w-4" fill="currentColor"><use href="#icon-export-bestiary"></use></svg> 'Export Bestiary' feature to save a JSON backup file to your computer.</p>
               <p>This backup file is the <strong>only way</strong> to:</p>
               <ul class="list-disc list-inside space-y-1 pl-2">
                  <li>Recover your data if your browser storage is cleared.</li>
                  <li>Transfer your bestiaries between different browsers or computers.</li>
               </ul>
            </div>
            <div class="mt-6 text-right">
               <button id="first-use-ok-btn" class="btn-primary">Okay, I Understand</button>
            </div>
         </div>
			
			<div id="import-db-confirm-modal" class="modal-content bg-white rounded-xl custom-shadow bordered-container card-font-style p-6 w-full max-w-md transform scale-95 hidden" onclick="event.stopPropagation()">
             <h3 class="text-lg font-bold text-red-700">Overwrite Database?</h3>
             <p class="mt-2 text-sm">Are you sure you want to import a full database backup? This action will <strong>permanently delete all current bestiaries and settings</strong> before importing the data from the selected file. This cannot be undone.</p>
             <p class="mt-2 text-sm font-semibold">It is strongly recommended to export your current database first if you have data you wish to keep.</p>
             <div class="mt-6 flex justify-end space-x-2">
                 <button id="import-db-cancel-btn" title="Close" class="btn-secondary">Cancel</button>
                 <button id="import-db-confirm-btn" class="btn-primary bg-red-600 hover:bg-red-700 border-red-800">Confirm & Import</button> </div>
         </div>

         <div id="export-reminder-modal" class="modal-content bg-white rounded-xl custom-shadow bordered-container card-font-style p-6 w-full max-w-md transform scale-95 hidden" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-4">
               <h3 class="text-lg font-bold text-slate-700">Unsaved Changes</h3>
               <button title="Close" class="modal-close-btn text-gray-500 hover:text-black text-2xl leading-none">&times;</button>
            </div>
            <div class="space-y-3 text-sm">
               <p>You have made changes to the bestiary since your last export.</p>
               <p>It's recommended to export your bestiary frequently as a backup.</p>
            </div>
            <div class="mt-4 flex items-center">
                <input type="checkbox" id="hide-export-reminder-checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                <label for="hide-export-reminder-checkbox" class="ml-2 label-text text-xs">Don't show these warnings again</label>
            </div>
            <div class="mt-6 flex justify-end space-x-2">
               <button id="reminder-dismiss-btn" class="btn-secondary">Dismiss</button>
               <button id="reminder-export-btn" class="btn-primary">Export Now</button>
            </div>
         </div>

         <div id="settings-modal" class="modal-content bg-white rounded-xl custom-shadow bordered-container card-font-style p-6 w-full max-w-3xl transform scale-95 hidden" onclick="event.stopPropagation()">
        <div class="flex justify-between items-center mb-4">
           <h3 class="font-bold text-slate-700">Settings</h3>
           <button title="Close" class="modal-close-btn text-gray-500 hover:text-black text-2xl leading-none">&times;</button>
        </div>

        <div class="flex flex-col md:flex-row gap-6">

           <div class="w-full md:w-1/2 space-y-4">

              <div id="bestiary-settings-group" class="space-y-2 border border-gray-300 rounded-lg p-3 pt-5 relative">
                 <h4 class="font-bold text-sm text-slate-600 absolute -top-2.5 left-4 bg-white px-1">Bestiary Default Settings</h4>
                 <p class="text-xs text-gray-500">These settings are applied to all new NPCs created in this bestiary.</p>
                 <div class="flex items-center">
                    <input type="checkbox" id="bestiary-add-description" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                    <label for="bestiary-add-description" class="ml-2 label-text">Add description to the NPC</label>
                 </div>
                 <div class="flex items-center">
                    <input type="checkbox" id="bestiary-add-title" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                    <label for="bestiary-add-title" class="ml-2 label-text">Add a title</label>
                 </div>
                 <div class="flex items-center">
                    <input type="checkbox" id="bestiary-add-image-link" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                    <label for="bestiary-add-image-link" class="ml-2 label-text">Add an image link</label>
                 </div>
                 <div class="flex items-center">
                    <input type="checkbox" id="bestiary-use-drop-cap" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                    <label for="bestiary-use-drop-cap" class="ml-2 label-text">Use a drop cap in the description</label>
                 </div>
              </div>

              <div class="space-y-2 border border-gray-300 rounded-lg p-3 pt-5 relative">
                 <h4 class="font-bold text-sm text-slate-600 absolute -top-2.5 left-4 bg-white px-1">Global App Settings</h4>
                 <div class="flex items-center">
                    <input type="checkbox" id="setting-solo-card-mode" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                    <label for="setting-solo-card-mode" class="ml-2 label-text text-xs">Use "Solo Card Mode" (only one card open at a time)</label>
                 </div>
                 <div class="flex items-center">
                    <input type="checkbox" id="setting-disable-unload-warning" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                    <label for="setting-disable-unload-warning" class="ml-2 label-text text-xs">Disable warning prompt when closing tab with unsaved exports</label>
                 </div>
              </div>
           </div>

           <div class="w-full md:w-1/2 space-y-3">
              <div class="space-y-2 border border-gray-300 rounded-lg p-3 pt-5 relative">
                 <h4 class="font-bold text-sm text-slate-600 absolute -top-2.5 left-4 bg-white px-1">Global Graphics Settings</h4>

                 <div class="flex items-center justify-between">
                    <div class="flex items-center">
                       <input type="checkbox" id="setting-convert-webp" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                       <label for="setting-convert-webp" class="ml-2 label-text text-xs">Convert to WebP format</label>
                    </div>
                    <div class="flex items-center">
                       <label for="setting-webp-quality" class="ml-4 mr-2 label-text text-xs">Quality (%)</label>
                       <input type="number" id="setting-webp-quality" class="info-input h-5 w-16 text-center" min="10" max="100" value="80">
                    </div>
                 </div>

                 <hr class="my-2">

                 <div class="flex items-center">
                    <input type="checkbox" id="setting-resize-portrait" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                    <label for="setting-resize-portrait" class="ml-2 label-text text-xs">Resize NPC Portrait (Image)</label>
                 </div>
                 <div class="flex items-center justify-end space-x-2">
                    <label for="setting-portrait-max-width" class="label-text text-xs">Max Width (px)</label>
                    <input type="number" id="setting-portrait-max-width" class="info-input h-5 w-20 text-center" min="50" value="1000">
                    <label for="setting-portrait-max-height" class="ml-2 label-text text-xs">Max Height (px)</label>
                    <input type="number" id="setting-portrait-max-height" class="info-input h-5 w-20 text-center" min="50" value="1000">
                 </div>

                 <hr class="my-2">

                 <div class="flex items-center">
                    <input type="checkbox" id="setting-resize-token" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                    <label for="setting-resize-token" class="ml-2 label-text text-xs">Resize NPC Token</label>
                 </div>
                 <div class="flex items-center justify-end space-x-2">
                    <label for="setting-token-size" class="label-text text-xs">Width/Height (px)</label>
                    <input type="number" id="setting-token-size" class="info-input h-5 w-20 text-center" min="50" value="300">
                 </div>

                 <hr class="my-2">

                 <div class="flex items-center">
                    <input type="checkbox" id="setting-resize-camera-token" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                    <label for="setting-resize-camera-token" class="ml-2 label-text text-xs">Resize NPC Camera Token</label>
                 </div>
                 <div class="flex items-center justify-end space-x-2">
                    <label for="setting-camera-token-max-width" class="label-text text-xs">Max Width (px)</label>
                    <input type="number" id="setting-camera-token-max-width" class="info-input h-5 w-20 text-center" min="50" value="1000">
                    <label for="setting-camera-token-max-height" class="ml-2 label-text text-xs">Max Height (px)</label>
                    <input type="number" id="setting-camera-token-max-height" class="info-input h-5 w-20 text-center" min="50" value="1000">
                 </div>

              </div>
           </div>
        </div>

        <div class="text-right pt-4 mt-4 border-t">
           <button id="settings-ok-btn" class="btn-primary">OK</button>
        </div>
     </div>

         <div id="hp-modal" class="bg-white rounded-xl custom-shadow bordered-container card-font-style p-4 space-y-3 w-80 hidden modal-content">
            <div class="flex justify-between items-center mb-2">
               <h3 class="font-bold text-slate-700">Hit Dice Calculator</h3>
               <button id="hp-modal-close" title="Close" class="modal-close-btn text-gray-500 hover:text-black text-2xl leading-none">&times;</button>
            </div>
            <div class="space-y-2">
               <div>
                  <label for="hp-dice-string" class="label-text">Dice Expression</label>
                  <input type="text" id="hp-dice-string" class="info-input w-full" title="Click the icons below to build the dice expression.">
                  <button id="hp-clear-btn" class="clear-btn">clear</button>
               </div>
               <div id="hp-dice-selector" class="dice-selector-container flex items-center justify-center pt-2">
                  </div>
            </div>
            <div class="text-right pt-2">
               <button id="hp-apply-btn" class="btn-primary">Apply</button>
            </div>
         </div>

         <div id="boilerplate-modal" class="modal-content bg-white rounded-xl custom-shadow bordered-container card-font-style p-6 w-full max-w-lg transform scale-95 hidden" onclick="event.stopPropagation()">
                <h3 class="text-lg font-bold">Edit Description</h3>
                <textarea id="boilerplate-editor" rows="6" class="mt-4 w-full rounded-md border-gray-300 info-input"></textarea>
                <div class="mt-4 flex justify-end gap-2">
                    <button title="Close" class="btn-secondary">Cancel</button>
                    <button class="btn-primary">Save</button>
                </div>
            </div>

         <div id="attack-helper-modal" class="modal-content bg-white rounded-xl custom-shadow bordered-container card-font-style p-6 w-full max-w-4xl transform scale-95 overflow-y-auto max-h-screen hidden" onclick="event.stopPropagation()">
                <h3 class="text-lg font-bold">Attack Helper</h3>

                <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                    <div>
                        <label for="attack-type" class="label-text mb-1">Attack Type</label>
                        <select id="attack-type" class="rounded-md border-gray-300 info-select w-full" title="Choose the type of attack (e.g., Melee Weapon, Ranged Spell)."><option>Melee Weapon Attack</option><option>Ranged Weapon Attack</option><option>Melee Spell Attack</option><option>Ranged Spell Attack</option></select>
                    </div>
                    <div>
                        <label for="attack-bonus" class="label-text mb-1">To Hit Bonus</label>
                        <input id="attack-bonus" type="number" placeholder="e.g., 5" class="rounded-md border-gray-300 info-input w-full" title="Enter the attack bonus. The '+' will be added automatically.">
                    </div>
                     <div>
                        <label for="attack-reach" class="label-text mb-1">Reach / Range (ft.)</label>
                        <input id="attack-reach" type="text" placeholder="e.g., 5 or 30/120" class="rounded-md border-gray-300 info-input w-full" title="Enter the attack's range or reach. 'ft.' will be added automatically.">
                    </div>
                    <div>
                        <label for="attack-target" class="label-text mb-1">Target</label>
                        <select id="attack-target" class="rounded-md border-gray-300 info-select w-full" title="Select the target of the attack."><option>one target</option><option>one creature</option><option>self</option><option>one willing creature</option><option>all creatures in range</option></select>
                    </div>
                </div>

                <div id="all-damage-rows-container" class="mt-4 space-y-2">
                    <div class="p-3 border rounded-lg bg-gray-50">
                        <div class="flex flex-wrap items-center gap-4 text-sm">
                            <div class="flex-grow">
                                <label for="attack-damage-dice" class="label-text mb-1">Primary Damage</label>
                                <input id="attack-damage-dice" type="text" placeholder="e.g., 1d8 + 2" class="w-full rounded-md border-gray-300 info-input" title="Enter the damage dice and bonus manually, or use the clickable icons.">
                        <button id="attack-damage-dice-clear-btn" class="clear-btn">clear</button>
                            </div>
                            <div id="primary-dice-selector" class="dice-selector-container flex items-center self-end"></div>
                            <div class="self-end">
                                <label for="attack-damage-type" class="label-text mb-1 invisible">Type</label> <select id="attack-damage-type" class="rounded-md border-gray-300 info-select" title="Select the type of damage this attack deals."></select>
                            </div>
                            <div class="w-6 h-6"></div> </div>
                    </div>
                </div>

                <button class="btn-secondary btn-xs mt-2" title="Add another damage component to this attack, for effects like poison or secondary magic damage.">+ Add Damage Type</button>

                <div class="mt-6 flex justify-end gap-2">
                    <button title="Close" class="btn-secondary">Cancel</button>
                    <button class="btn-primary" title="Create the formatted attack description and put it in the main description box.">Generate & Insert</button>
                </div>
            </div>

         <div id="alert-modal" class="modal-content bg-white rounded-xl custom-shadow bordered-container card-font-style p-6 w-full max-w-sm transform scale-95 hidden" onclick="event.stopPropagation()">
                <h3 id="alert-title" class="text-lg font-bold">Alert</h3>
                <p id="alert-message-text" class="mt-2"></p>
                <div class="mt-4 flex justify-end space-x-2">
               <button id="alert-cancel-btn" title="Close" class="btn-secondary hidden">Cancel</button>
                    <button id="alert-ok-btn" class="btn-primary">OK</button>
                </div>
            </div>
			
			<div id="clipboard-modal" class="modal-content bg-white rounded-xl custom-shadow bordered-container card-font-style p-6 w-full max-w-2xl hidden transform scale-95" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-4">
               <h3 class="text-lg font-bold">Manage Clipboard Text</h3>
               <button title="Close" class="modal-close-btn text-gray-500 hover:text-black text-2xl leading-none">&times;</button>
            </div>
            <div class="h-full flex flex-col">
               <textarea id="clipboard-text-area" class="w-full h-full info-input rounded-xl custom-shadow bordered-container p-4" style="min-height: 400px; resize: none;" placeholder="Paste text here (Ctrl+V) to clean and process it..." title="Paste text here. You can use Ctrl+J to join selected lines and Ctrl+E to cycle text case."></textarea>
               <div class="flex justify-between items-center mt-4">
                  <div>
                     <button id="clipboard-clear-btn" class="btn-primary" title="Clear all text from this window.">Clear Text Window</button>
                  </div>
                  <div class="flex items-center space-x-4">
                     <div class="flex items-center">
                        <input type="checkbox" id="bestiary-pick-out-titles" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" title="Check this to automatically bold the first sentence of a paragraph if the sentence is 4 words or less, as this is likely to be a title.">
                        <label for="bestiary-pick-out-titles" class="ml-2 label-text text-xs">Pick out titles</label>
                     </div>
                     <button id="clipboard-cancel-btn" title="Close this modal without pasting." class="btn-secondary">Cancel</button>
                     <button id="clipboard-process-btn" class="btn-primary" title="Process the text (applying title formatting if checked) and paste it into the NPC description at the current cursor position.">Process & Paste Text</button>
                  </div>
               </div>
            </div>
         </div>

			<div id="import-modal" class="modal-content bg-white rounded-xl custom-shadow bordered-container card-font-style p-6 w-full max-w-7xl h-[95vh] hidden transform scale-95" onclick="event.stopPropagation()">

            <div class="flex justify-between items-center mb-4">
               <h3 class="text-lg font-bold">Import NPC from Text</h3>
               <button title="Close" class="modal-close-btn text-gray-500 hover:text-black text-2xl leading-none">&times;</button>
            </div>

            <div class="flex gap-6 h-[calc(100%-80px)]">
               
               <div class="w-1/2 h-full flex flex-col">
                  
                  <div id="import-pane-raw" class="h-full flex flex-col">
                     <label for="import-source-area" class="label-text mb-1 font-semibold">Raw Text</label>
                     <textarea id="import-source-area" class="w-full h-full info-input rounded-xl custom-shadow bordered-container p-4" style="min-height: 400px; resize: none;" placeholder="Paste raw NPC text here..."></textarea>
                  </div>

                  <div id="import-pane-filtered" class="h-full flex flex-col hidden relative">
                     <label for="import-text-area" class="label-text mb-1 font-semibold">Filtered Text (Read-only)</label>
                     <span id="import-filter-status" class="absolute top-8 right-6 z-10 text-sm text-red-700" style="height: 1.25rem;">&nbsp;</span>
                     <textarea id="import-text-area" class="w-full h-full info-input rounded-xl custom-shadow bordered-container p-4" style="min-height: 400px; resize: none;" placeholder="Filtered text will appear here..." readonly></textarea>
                  </div>

                  <div class="flex justify-between items-center mt-4">
                     <div class="flex space-x-2">
                        <button id="import-clear-btn" class="btn-primary" title="Clear the raw text area.">Clear Text Window</button>
                        <button id="import-toggle-view-btn" class="btn-primary" title="Toggle between raw and filtered text.">View Filtered Text</button>
                     </div>
                     <div class="flex items-center space-x-2">
                        <label for="import-filter-select" class="label-text">Filter:</label>
                        <select id="import-filter-select" class="info-select h-8" style="min-width: 150px;" title="Apply a pre-defined filter to clean up common PDF copy/paste errors.">
                           <option value="noFilter" selected>No Filter</option>
                           <option value="pdfFilter1">PDF Filter 1</option>
                           <option value="pdfFilter2">PDF Filter 2</option>
                           <option value="pdfFilter3">PDF Filter 3</option>
                           <option value="pdfFilter4">PDF Filter 4</option>
                           <option value="pdfFilter5">PDF Filter 5</option>
                        </select>
                     </div>
                  </div>
               </div>

               <div class="w-1/2 h-full flex flex-col">
                  <label class="label-text mb-1 font-semibold">Preview</label>
                  <div id="import-viewport" class="w-full h-full bg-cover bg-center rounded-xl custom-shadow overflow-auto bordered-container" style="padding-top: 10px; background-image: url('graphics/viewport.jpg');">
                  </div>
                  <div class="flex justify-end items-center mt-4 space-x-2">
                     <button id="import-cancel-btn" title="Close" class="btn-secondary">Cancel</button>
                     <button id="import-confirm-btn" class="btn-primary" title="Import the parsed NPC into your bestiary.">Import NPC</button>
                  </div>
               </div>
            </div>
         </div>
			
			<div id="fg-export-modal" class="modal-content bg-white rounded-xl custom-shadow bordered-container card-font-style p-6 w-full max-w-3xl hidden transform scale-95" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-4">
               <h3 class="text-lg font-bold text-slate-700">Fantasy Grounds Export Settings</h3>
               <button title="Close" class="modal-close-btn text-gray-500 hover:text-black text-2xl leading-none">&times;</button>
            </div>

            <div class="flex gap-6">
               
               <div class="w-2/3 space-y-3">
                  <div>
                     <label for="fg-bestiary-title" class="label-text">Bestiary Title</label>
                     <input type="text" id="fg-bestiary-title" class="info-input w-full" pattern="[a-zA-Z0-9 ]*" title="Alphanumeric characters and spaces only. This will be used to generate the XML module name (e.g., 'bestiarytitle').">
                  </div>
                  
                  <div>
                     <label for="fg-bestiary-author" class="label-text">Bestiary Author</label>
                     <input type="text" id="fg-bestiary-author" class="info-input w-full" title="The author name to be listed in the module.">
                  </div>

                  <div>
                     <label for="fg-bestiary-filename" class="label-text">Bestiary Filename</label>
                     <input type="text" id="fg-bestiary-filename" class="info-input w-full" pattern="[a-zA-Z0-9 ]*" title="Alphanumeric characters and spaces only. This will be the name of the file you save.">
                  </div>

                  <div>
                     <label for="fg-bestiary-displayname" class="label-text">Bestiary Display Name</label>
                     <input type="text" id="fg-bestiary-displayname" class="info-input w-full" placeholder="Optional" title="A separate display name for the module, if different from the title.">
                  </div>

                  <div class="flex items-center space-x-8 pt-2">
                     <div class="flex items-center">
                        <input type="checkbox" id="fg-mod-lock" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                        <label for="fg-mod-lock" class="ml-2 label-text">Read Only</label>
                     </div>
                     <div class="space-y-1">
                        <div class="flex items-center">
                           <input type="radio" id="fg-gm-view" name="fg-view-mode" value="true" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500">
                           <label for="fg-gm-view" class="ml-2 label-text">GM View Only</label>
                        </div>
                        <div class="flex items-center">
                           <input type="radio" id="fg-player-view" name="fg-view-mode" value="false" class="h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500">
                           <label for="fg-player-view" class="ml-2 label-text">Player Module</label>
                        </div>
                     </div>
                  </div>
               </div>

					<div class="w-1/3">
                  <label class="label-text text-center mb-1">Cover Image (100x100)</label>
                  <div id="fg-cover-image" title="Click or drag a PNG image here to set the module's cover." class="w-full h-40 info-input cursor-pointer flex items-center justify-center text-gray-400 text-xs text-center overflow-hidden p-2">
                     <span>Click or Drag a Cover Image Here</span>
                  </div>
                  <input type="file" id="fg-cover-upload" class="hidden" accept="image/png">
                  <button id="fg-cover-clear-btn" class="clear-btn float-right">Clear Image</button>
               </div>
            </div>

            <div class="mt-6 flex justify-end gap-2">
               <button id="fg-export-cancel-btn" title="Close" class="btn-secondary">Cancel</button>
               <button id="fg-export-save-btn" class="btn-primary" title="Save these settings and proceed to export.">Save & Export</button>
            </div>
         </div>
			
         <script src="icons.js" defer></script>
         <script src="ui-elements.js" defer></script>
         <script src="ui-updates.js" defer></script>
         <script src="ui-listener-setups.js" defer></script>
         <script src="viewport.js" defer></script>
         <script src="main.js" defer></script>
         <script src="helpers.js" defer></script>
         <script src="graphics.js" defer></script>
         <script src="import-cleaner.js" defer></script>
         <script src="filters.js" defer></script>
         <script src="import.js" defer></script>
         <script src="export-fg.js" defer></script>
			
		</div>	
   </body>
</html>